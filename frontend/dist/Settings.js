import{c as Ae}from"./index.js";import{H as ia,U as na,V as ut,p as Ke,a as te,k as v,Q as _t,S as mt,g as e,e as p,l as a,o as r,i as h,h as n,j as Je,t as q,B as ee,d as at,s as be,q as Oe,w as Me,r as Pe,K as Xt,c as bt,f as ze,L as It,x as Ge,n as m,R as oa,E as it,F as nt,m as Jt,T as Tt,C as St,y as Ct,b as tt,P as la,z as Kt,u as yt,W as $t,X as da,D as Xe,Y as ft,Z as $e,v as Yt,G as ca,$ as va}from"./vendor.js";import{a as rt}from"./api.js";import{F as ea}from"./FormField.js";import{L as ta}from"./LoadingSpinner.js";const Zt={load:()=>rt.get("/api/v2/settings"),save:c=>rt.put("/api/v2/settings",c),test:{birdweather:c=>rt.post("/api/v2/test/birdweather",c),mqtt:c=>rt.post("/api/v2/test/mqtt",c),database:c=>rt.post("/api/v2/test/database",c),audio:c=>rt.post("/api/v2/test/audio",c)},species:{search:c=>{const t=encodeURIComponent(c);return rt.get(`/api/v2/species/search?q=${t}`)},rangeFilter:(c,t,d)=>rt.get(`/api/v2/species/range?lat=${c}&lon=${t}&model=${d}`),all:()=>rt.get("/api/v2/species")},system:{audioDevices:()=>rt.get("/api/v2/system/audio-devices"),ffmpegStatus:()=>rt.get("/api/v2/system/ffmpeg"),supportDump:c=>rt.post("/api/v2/system/support-dump",c)},validate:{all:c=>rt.post("/api/v2/settings/validate",c),section:(c,t)=>rt.post(`/api/v2/settings/validate/${c}`,t)}};function Ut(){return{node:{name:"",identifier:""},birdnet:{modelPath:"",labelPath:"",sensitivity:1,threshold:.3,overlap:0,locale:"en",threads:4,latitude:0,longitude:0,dynamicThreshold:{enabled:!1,debug:!1,trigger:3,min:.1,validHours:24},rangeFilter:{model:"latest",threshold:.03,speciesCount:null,species:[]},database:{type:"sqlite",path:"/data/birdnet.db",host:"localhost",port:3306,name:"birdnet",username:"",password:""}},audio:{source:"",rtsp:{transport:"tcp",urls:[]},quality:{sampleRate:48e3,bitRate:192,channels:1},equalizer:{enabled:!1,filters:[]},export:{format:"wav",quality:"96k",enabled:!1,debug:!1,path:"clips/"},retention:{policy:"none",maxAge:"7d",maxUsage:"80%",minClips:10,keepSpectrograms:!1},soundLevel:{enabled:!1,interval:60}},filters:{privacy:{enabled:!1,confidence:.5,debug:!1},dogBark:{enabled:!1,confidence:.5,remember:30,debug:!1,species:[]}},integration:{birdweather:{enabled:!1,id:"",latitude:0,longitude:0,locationAccuracy:1e3,threshold:.7,debug:!1},mqtt:{enabled:!1,broker:"",port:1883,topic:"birdnet",tls:{enabled:!1,skipVerify:!1}},observability:{prometheus:{enabled:!1,port:9090,path:"/metrics"}},weather:{provider:"none",enabled:!1}},security:{autoTLS:{enabled:!1,host:""},basicAuth:{enabled:!1,username:"",password:""},googleAuth:{enabled:!1,clientId:"",clientSecret:"",userId:""},githubAuth:{enabled:!1,clientId:"",clientSecret:"",userId:""},allowSubnetBypass:{enabled:!1,subnets:[]}},species:{include:{enabled:!1,species:[]},exclude:{enabled:!1,species:[]},config:{}},support:{sentry:{enabled:!1,dsn:"",environment:"production",includePrivateInfo:!1},telemetry:{enabled:!0,includeSystemInfo:!0,includeAudioInfo:!1}}}}const ua={formData:Ut(),originalData:Ut(),isLoading:!1,isSaving:!1,activeSection:"node",error:null},Le=ia(ua),pa=ut(Le,c=>JSON.stringify(c.formData)!==JSON.stringify(c.originalData));ut(Le,c=>c.activeSection);ut(Le,c=>c.isLoading);ut(Le,c=>c.isSaving);const ga=ut(Le,c=>c.formData.node),ha=ut(Le,c=>c.formData.birdnet),ba=ut(Le,c=>c.formData.audio),ma=ut(Le,c=>c.formData.filters),fa=ut(Le,c=>c.formData.integration),_a=ut(Le,c=>c.formData.security),xa=ut(Le,c=>c.formData.species),wa=ut(Le,c=>c.formData.support),O={async loadSettings(){Le.update(c=>({...c,isLoading:!0,error:null}));try{const c=await Zt.load();Le.update(t=>({...t,formData:{...Ut(),...c},originalData:JSON.parse(JSON.stringify({...Ut(),...c})),isLoading:!1}))}catch(c){const t=c instanceof Error?c.message:"Failed to load settings";throw Le.update(d=>({...d,isLoading:!1,error:t})),c}},updateSection(c,t){Le.update(d=>({...d,formData:{...d.formData,[c]:{...d.formData[c],...t}}}))},async saveSettings(){Le.update(c=>({...c,isSaving:!0,error:null}));try{const c=na(Le),t=await Zt.save(c.formData);Le.update(d=>({...d,formData:t,originalData:JSON.parse(JSON.stringify(t)),isSaving:!1}))}catch(c){const t=c instanceof Error?c.message:"Failed to save settings";throw Le.update(d=>({...d,isSaving:!1,error:t})),c}},resetSection(c){Le.update(t=>({...t,formData:{...t.formData,[c]:JSON.parse(JSON.stringify(t.originalData[c]))}}))},resetAllSettings(){Le.update(c=>({...c,formData:JSON.parse(JSON.stringify(c.originalData))}))},setActiveSection(c){Le.update(t=>({...t,activeSection:c}))},clearError(){Le.update(c=>({...c,error:null}))}};var ya=v('<div class="label"><span class="label-text-alt text-error"> </span></div>'),ka=v("<div><!> <!></div>");function Qe(c,t){Ke(t,!0);let d=te(t,"value",15),N=te(t,"step",3,1),re=te(t,"placeholder",3,""),se=te(t,"helpText",3,""),s=te(t,"required",3,!1),i=te(t,"disabled",3,!1),g=te(t,"className",3,""),ie=mt(t,["$$slots","$$events","$$legacy","label","value","onUpdate","min","max","step","placeholder","helpText","required","disabled","error","className"]);function oe(M){const G=typeof M=="number"?M:parseFloat(String(M));isNaN(G)||(d(G),t.onUpdate(G))}var Y=ka();_t(Y,()=>({class:g(),...ie}));var P=a(Y);const S=p(()=>t.label.toLowerCase().replace(/\s+/g,"-")),L=p(()=>t.error?"input-error":"");ea(P,{type:"number",get name(){return e(S)},get label(){return t.label},get min(){return t.min},get max(){return t.max},get step(){return N()},get placeholder(){return re()},get helpText(){return se()},get required(){return s()},get disabled(){return i()},onChange:oe,get inputClassName(){return e(L)},get value(){return d()},set value(M){d(M)}});var E=r(P,2);{var T=M=>{var G=ya(),z=a(G),I=a(z);q(()=>ee(I,t.error)),n(M,G)};h(E,M=>{t.error&&M(T)})}n(c,Y),Je()}function Sa(c,t,d){const N=c.currentTarget;t(N.checked),d.onchange?.(t())}var Ta=v('<span class="label-text"> </span>'),Ca=v('<button type="button" class="help-icon ml-1 text-info hover:text-info-focus transition-colors" aria-label="Help information">ⓘ</button>'),La=v('<div class="label"><span class="label-text-alt text-base-content/70"> </span></div>'),Aa=v('<div class="absolute z-50 p-2 mt-1 text-sm bg-base-300 border border-base-content/20 rounded shadow-lg max-w-xs" role="tooltip"> </div>'),Ma=v('<div><label class="label cursor-pointer justify-start"><input type="checkbox"/> <!> <!></label> <!> <!></div>');function Ee(c,t){Ke(t,!0);let d=te(t,"checked",15),N=te(t,"disabled",3,!1),re=te(t,"className",3,""),se=te(t,"size",3,"xs"),s=te(t,"variant",3,"primary"),i=mt(t,["$$slots","$$events","$$legacy","checked","disabled","label","id","className","size","variant","helpText","tooltip","children","onchange"]),g=be(!1);const ie={xs:"checkbox-xs",sm:"checkbox-sm",md:"",lg:"checkbox-lg"},oe={default:"",primary:"checkbox-primary",secondary:"checkbox-secondary",accent:"checkbox-accent"};var Y=Ma();_t(Y,k=>({class:k,...i}),[()=>Ae("form-control relative",re())]);var P=a(Y),S=a(P);S.__change=[Sa,d,t];var L=r(S,2);{var E=k=>{var b=bt(),V=ze(b);It(V,()=>t.children),n(k,b)},T=(k,b)=>{{var V=A=>{var ne=Ta(),w=a(ne);q(()=>ee(w,t.label)),n(A,ne)};h(k,A=>{t.label&&A(V)},b)}};h(L,k=>{t.children?k(E):k(T,!1)})}var M=r(L,2);{var G=k=>{var b=Ca();Ge("mouseenter",b,()=>m(g,!0)),Ge("mouseleave",b,()=>m(g,!1)),Ge("focus",b,()=>m(g,!0)),Ge("blur",b,()=>m(g,!1)),n(k,b)};h(M,k=>{t.tooltip&&k(G)})}var z=r(P,2);{var I=k=>{var b=La(),V=a(b),A=a(V);q(()=>ee(A,t.helpText)),n(k,b)};h(z,k=>{t.helpText&&k(I)})}var K=r(z,2);{var J=k=>{var b=Aa(),V=a(b);q(()=>ee(V,t.tooltip)),n(k,b)};h(K,k=>{t.tooltip&&e(g)&&k(J)})}q(k=>{Me(P,"for",t.id),Me(S,"id",t.id),S.disabled=N(),Pe(S,1,k)},[()=>Oe(Ae("checkbox mr-2",ie[se()],oe[s()]))]),Xt(S,d),n(c,Y),Je()}at(["change"]);function Da(c,t,d){const N=c.currentTarget;t(N.value),d.onchange?.(t())}var Pa=v('<span class="text-error ml-1">*</span>'),Ba=v('<button type="button" class="help-icon ml-1 text-info hover:text-info-focus transition-colors" aria-label="Help information">ⓘ</button>'),Ia=v('<label class="label justify-start"><span class="label-text"> <!></span> <!></label>'),Ea=v("<option disabled> </option>"),qa=v("<option> </option>"),Na=v('<div class="label"><span class="label-text-alt text-base-content/70"> </span></div>'),za=v('<div class="absolute z-50 p-2 mt-1 text-sm bg-base-300 border border-base-content/20 rounded shadow-lg max-w-xs" role="tooltip"> </div>'),ja=v("<div><!> <select><!><!></select> <!> <!></div>");function pt(c,t){Ke(t,!0);let d=te(t,"value",15),N=te(t,"disabled",3,!1),re=te(t,"required",3,!1),se=te(t,"className",3,""),s=te(t,"size",3,"sm"),i=mt(t,["$$slots","$$events","$$legacy","value","options","label","id","placeholder","disabled","required","helpText","tooltip","className","size","children","onchange"]),g=be(!1);const ie={xs:"select-xs",sm:"select-sm",md:"",lg:"select-lg"};var oe=ja();_t(oe,k=>({class:k,...i}),[()=>Ae("form-control relative",se())]);var Y=a(oe);{var P=k=>{var b=Ia(),V=a(b),A=a(V),ne=r(A);{var w=ae=>{var ue=Pa();n(ae,ue)};h(ne,ae=>{re()&&ae(w)})}var U=r(V,2);{var Z=ae=>{var ue=Ba();Ge("mouseenter",ue,()=>m(g,!0)),Ge("mouseleave",ue,()=>m(g,!1)),Ge("focus",ue,()=>m(g,!0)),Ge("blur",ue,()=>m(g,!1)),n(ae,ue)};h(U,ae=>{t.tooltip&&ae(Z)})}q(()=>{Me(b,"for",t.id),ee(A,`${t.label??""} `)}),n(k,b)};h(Y,k=>{t.label&&k(P)})}var S=r(Y,2);S.__change=[Da,d,t];var L=a(S);{var E=k=>{var b=Ea(),V=a(b);b.value=b.__value="",q(()=>ee(V,t.placeholder)),n(k,b)};h(L,k=>{t.placeholder&&k(E)})}var T=r(L);{var M=k=>{var b=bt(),V=ze(b);It(V,()=>t.children),n(k,b)},G=(k,b)=>{{var V=A=>{var ne=bt(),w=ze(ne);it(w,17,()=>t.options,nt,(U,Z)=>{var ae=qa(),ue=a(ae),me={};q(()=>{ae.disabled=e(Z).disabled,ee(ue,e(Z).label),me!==(me=e(Z).value)&&(ae.value=(ae.__value=e(Z).value)??"")}),n(U,ae)}),n(A,ne)};h(k,A=>{t.options&&A(V)},b)}};h(T,k=>{t.children?k(M):k(G,!1)})}var z=r(S,2);{var I=k=>{var b=Na(),V=a(b),A=a(V);q(()=>ee(A,t.helpText)),n(k,b)};h(z,k=>{t.helpText&&k(I)})}var K=r(z,2);{var J=k=>{var b=za(),V=a(b);q(()=>ee(V,t.tooltip)),n(k,b)};h(K,k=>{t.tooltip&&e(g)&&k(J)})}q(k=>{Me(S,"id",t.id),S.disabled=N(),S.required=re(),Pe(S,1,k)},[()=>Oe(Ae("select select-bordered w-full",ie[s()]))]),oa(S,d),n(c,oe),Je()}at(["change"]);function Ra(c,t,d){const N=c.currentTarget;t(N.value),d.onchange?.(t())}function Ua(c,t,d,N){const re=c.currentTarget;t(re.value),m(d,!1),N.oninput?.(t())}var Oa=v('<span class="text-error ml-1">*</span>'),Fa=v('<button type="button" class="help-icon ml-1 text-info hover:text-info-focus transition-colors" aria-label="Help information">ⓘ</button>'),Ha=v('<label class="label justify-start"><span class="label-text capitalize"> <!></span> <!></label>'),Qa=v('<span class="text-sm text-error mt-1"> </span>'),Ga=v('<div class="label"><span class="label-text-alt text-base-content/70"> </span></div>'),Va=v('<div class="absolute z-50 p-2 mt-1 text-sm bg-base-300 border border-base-content/20 rounded shadow-lg max-w-xs" role="tooltip"> </div>'),Wa=v("<div><!> <input/> <!> <!> <!></div>");function Ve(c,t){Ke(t,!0);let d=te(t,"value",15),N=te(t,"type",3,"text"),re=te(t,"disabled",3,!1),se=te(t,"required",3,!1),s=te(t,"readonly",3,!1),i=te(t,"maxlength",3,255),g=te(t,"className",3,""),ie=te(t,"size",3,"sm"),oe=mt(t,["$$slots","$$events","$$legacy","value","type","label","id","placeholder","disabled","required","readonly","pattern","minlength","maxlength","helpText","tooltip","className","size","validationMessage","onchange","oninput"]),Y=be(!1),P=be(!1),S=be(void 0),L=p(()=>()=>!e(S)||!e(P)?!0:e(S).validity.valid);function E(){m(P,!0)}function T(){m(P,!0)}const M={xs:"input-xs",sm:"input-sm",md:"",lg:"input-lg"};var G=Wa();_t(G,w=>({class:w,...oe}),[()=>Ae("form-control relative",g())]);var z=a(G);{var I=w=>{var U=Ha(),Z=a(U),ae=a(Z),ue=r(ae);{var me=x=>{var y=Oa();n(x,y)};h(ue,x=>{se()&&x(me)})}var u=r(Z,2);{var _=x=>{var y=Fa();Ge("mouseenter",y,()=>m(Y,!0)),Ge("mouseleave",y,()=>m(Y,!1)),Ge("focus",y,()=>m(Y,!0)),Ge("blur",y,()=>m(Y,!1)),n(x,y)};h(u,x=>{t.tooltip&&x(_)})}q(()=>{Me(U,"for",t.id),ee(ae,`${t.label??""} `)}),n(w,U)};h(z,w=>{t.label&&w(I)})}var K=r(z,2);K.__change=[Ra,d,t],K.__input=[Ua,d,P,t],Jt(K,w=>m(S,w),()=>e(S));var J=r(K,2);{var k=w=>{var U=Qa(),Z=a(U);q(()=>ee(Z,t.validationMessage||`Please enter a valid ${t.label||"value"}`)),n(w,U)};h(J,w=>{!e(L)&&e(P)&&w(k)})}var b=r(J,2);{var V=w=>{var U=Ga(),Z=a(U),ae=a(Z);q(()=>ee(ae,t.helpText)),n(w,U)};h(b,w=>{t.helpText&&w(V)})}var A=r(b,2);{var ne=w=>{var U=Va(),Z=a(U);q(()=>ee(Z,t.tooltip)),n(w,U)};h(A,w=>{t.tooltip&&e(Y)&&w(ne)})}q(w=>{Me(K,"type",N()),Me(K,"id",t.id),Me(K,"placeholder",t.placeholder),K.disabled=re(),K.required=se(),K.readOnly=s(),Me(K,"pattern",t.pattern),Me(K,"minlength",t.minlength),Me(K,"maxlength",i()),Pe(K,1,w)},[()=>Oe(Ae("input input-bordered w-full",M[ie()],!e(L)&&"input-error"))]),Ge("blur",K,E),Ge("invalid",K,T),Tt(K,d),n(c,G),Je()}at(["change","input"]);function Ka(c,t){m(t,!e(t))}var Ja=Ct('<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"></path></svg>'),Ya=Ct('<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>'),Za=v('<div class="absolute inset-y-0 right-0 flex items-center pr-3"><button type="button" class="btn btn-ghost btn-sm btn-square" tabindex="-1"><!></button></div>'),Xa=v('<li class="flex items-center gap-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path></svg> </li>'),$a=v('<div class="mt-2"><div class="text-xs text-base-content/70 mb-1">Suggestions:</div> <ul class="text-xs text-base-content/70 space-y-1"></ul></div>'),es=v('<div class="mt-2"><div class="flex items-center justify-between mb-1"><span class="text-sm font-medium">Password Strength:</span> <span> </span></div> <div class="w-full bg-base-200 rounded-full h-2"><div></div></div> <!></div>'),ts=v('<div class="label"><span class="label-text-alt text-error"> </span></div>'),as=v("<div><!> <!> <!> <!></div>");function ht(c,t){Ke(t,!0);let d=te(t,"value",15),N=te(t,"placeholder",3,""),re=te(t,"helpText",3,""),se=te(t,"required",3,!1),s=te(t,"disabled",3,!1),i=te(t,"className",3,""),g=te(t,"showStrength",3,!1),ie=te(t,"allowReveal",3,!0),oe=te(t,"autocomplete",3,"current-password"),Y=mt(t,["$$slots","$$events","$$legacy","label","value","onUpdate","placeholder","helpText","required","disabled","error","className","showStrength","allowReveal","autocomplete"]),P=be(!1);Math.random().toString(36).substring(2,11);let S=p(()=>{if(!g()||!d())return null;let A=0,ne=[];d().length>=8?A+=1:ne.push("At least 8 characters"),/[a-z]/.test(d())&&/[A-Z]/.test(d())?A+=1:ne.push("Mix of uppercase and lowercase"),/\d/.test(d())?A+=1:ne.push("At least one number"),/[^a-zA-Z0-9]/.test(d())?A+=1:ne.push("At least one special character");let w,U;return A<=1?(w="weak",U="text-error"):A===2?(w="fair",U="text-warning"):A===3?(w="good",U="text-info"):(w="strong",U="text-success"),{score:A,level:w,color:U,feedback:ne}});function L(A){const ne=String(A);d(ne),t.onUpdate(ne)}var E=as();_t(E,A=>({class:A,...Y}),[()=>Ae("form-control",i())],"svelte-1orzu0f");var T=a(E);const M=p(()=>e(P)?"text":"password"),G=p(()=>t.label.toLowerCase().replace(/\s+/g,"-")),z=p(()=>Ae("pr-12",t.error?"input-error":""));ea(T,{get type(){return e(M)},get name(){return e(G)},get label(){return t.label},get placeholder(){return N()},get helpText(){return re()},get required(){return se()},get disabled(){return s()},get autocomplete(){return oe()},onChange:L,get inputClassName(){return e(z)},get value(){return d()},set value(A){d(A)}});var I=r(T,2);{var K=A=>{var ne=Za(),w=a(ne);w.__click=[Ka,P];var U=a(w);{var Z=ue=>{var me=Ja();n(ue,me)},ae=ue=>{var me=Ya();n(ue,me)};h(U,ue=>{e(P)?ue(Z):ue(ae,!1)})}q(()=>{w.disabled=s(),Me(w,"aria-label",e(P)?"Hide password":"Show password")}),n(A,ne)};h(I,A=>{ie()&&A(K)})}var J=r(I,2);{var k=A=>{var ne=es(),w=a(ne),U=r(a(w),2),Z=a(U),ae=r(w,2),ue=a(ae);let me;var u=r(ae,2);{var _=x=>{var y=$a(),D=r(a(y),2);it(D,21,()=>e(S).feedback,nt,(X,ce)=>{var j=Xa(),F=r(a(j));q(()=>ee(F,` ${e(ce)??""}`)),n(X,j)}),n(x,y)};h(u,x=>{e(S)?.feedback&&e(S).feedback.length>0&&x(_)})}q((x,y,D)=>{Pe(U,1,`text-sm font-medium ${(e(S)?.color||"")??""}`,"svelte-1orzu0f"),ee(Z,x),Pe(ue,1,y,"svelte-1orzu0f"),me=St(ue,"",me,D)},[()=>e(S)?.level?e(S).level.charAt(0).toUpperCase()+e(S).level.slice(1):"",()=>Oe(Ae("h-2 rounded-full transition-all duration-300",{"bg-error":e(S)?.level==="weak","bg-warning":e(S)?.level==="fair","bg-info":e(S)?.level==="good","bg-success":e(S)?.level==="strong"})),()=>({width:`${e(S)?e(S).score/4*100:0}%`})]),n(A,ne)};h(J,A=>{g()&&e(S)&&d()&&A(k)})}var b=r(J,2);{var V=A=>{var ne=ts(),w=a(ne),U=a(w);q(()=>ee(U,t.error)),n(A,ne)};h(b,A=>{t.error&&A(V)})}n(c,E),Je()}at(["click"]);function Fe(c,t){return c===void 0||t===void 0?!1:JSON.stringify(c)!==JSON.stringify(t)}var ss=v('<span class="badge badge-primary badge-sm" role="status" aria-label="Settings changed">changed</span>'),rs=v('<p class="text-sm text-base-content/70 mt-1"> </p>'),is=v('<div><input type="checkbox" class="min-h-0"/> <div class="collapse-title px-6 py-4 min-h-0"><div class="flex items-center gap-2"><h3 class="text-xl font-semibold"> </h3> <!></div> <!></div> <div class="collapse-content px-6 pb-6"><!></div></div>');function ns(c,t){Ke(t,!0);let d=te(t,"defaultOpen",3,!0),N=te(t,"className",3,""),re=te(t,"hasChanges",3,!1),se=be(tt(d()));var s=is(),i=a(s),g=r(i,2),ie=a(g),oe=a(ie),Y=a(oe),P=r(oe,2);{var S=z=>{var I=ss();n(z,I)};h(P,z=>{re()&&z(S)})}var L=r(ie,2);{var E=z=>{var I=rs(),K=a(I);q(()=>ee(K,t.description)),n(z,I)};h(L,z=>{t.description&&z(E)})}var T=r(g,2),M=a(T);{var G=z=>{var I=bt(),K=ze(I);It(K,()=>t.children),n(z,I)};h(M,z=>{t.children&&z(G)})}q(z=>{Pe(s,1,z),ee(Y,t.title)},[()=>Oe(Ae("collapse collapse-open bg-base-100 shadow-xs",N()))]),Xt(i,()=>e(se),z=>m(se,z)),n(c,s),Je()}function Re(c,t){let d=te(t,"defaultOpen",3,!0),N=te(t,"className",3,""),re=mt(t,["$$slots","$$events","$$legacy","title","description","defaultOpen","className","originalData","currentData","children","hasChanges"]),se=p(()=>()=>t.hasChanges!==void 0?t.hasChanges:!t.originalData||!t.currentData?!1:JSON.stringify(t.originalData)!==JSON.stringify(t.currentData));const s=p(()=>e(se)());ns(c,la({get title(){return t.title},get description(){return t.description},get defaultOpen(){return d()},get className(){return N()},get hasChanges(){return e(s)}},()=>re,{children:(i,g)=>{var ie=bt(),oe=ze(ie);{var Y=P=>{var S=bt(),L=ze(S);It(L,()=>t.children),n(P,S)};h(oe,P=>{t.children&&P(Y)})}n(i,ie)},$$slots:{default:!0}}))}var os=da(v('<link rel="stylesheet" href="/assets/leaflet.css"/> <script src="/assets/leaflet.js"><\/script>',1)),ls=v('<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-6"><!></div>'),ds=v('<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-6 mt-4"><!> <!> <!></div>'),cs=v('<span class="loading loading-spinner loading-xs text-primary opacity-60"></span>'),vs=(c,t,d)=>{m(t,!0),d()},us=v('<span class="loading loading-spinner loading-xs mr-1"></span> Loading...',1),ps=(c,t)=>m(t,null),gs=v('<div class="alert alert-error mt-2"><svg class="stroke-current shrink-0 w-6 h-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <span> </span> <button type="button" class="btn btn-sm btn-ghost ml-auto" aria-label="Dismiss error"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>'),hs=v(`<div class="space-y-6"><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-6"><!> <!> <!> <!> <!></div> <div><h4 class="text-lg font-medium mt-6 pb-2">Custom BirdNET Classifier</h4> <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-6"><!> <!></div></div> <div><h4 class="text-lg font-medium mt-6 pb-2">Dynamic Threshold</h4> <!> <!></div> <div><h4 class="text-lg font-medium mt-6 pb-2">Range Filter</h4> <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-6"><div class="col-span-1 md:col-span-2"><label class="label justify-start" for="location-map"><span class="label-text">Station Location</span></label> <div class="form-control"><div id="location-map" class="h-[300px] rounded-lg border border-base-300" role="application" aria-label="Map for selecting station location"></div> <div class="label"><span class="label-text-alt">Station location, used to limit bird species to those probable in the region.</span></div></div></div> <div class="col-span-1 flex flex-col justify-start gap-x-6"><!> <!> <!> <!> <div class="form-control"><div class="label justify-start"><span class="label-text">Current Species Count</span></div> <div class="flex items-center space-x-2"><div class="flex items-center space-x-2"><div> </div> <!></div> <button type="button" class="btn btn-sm btn-outline"><!></button></div> <div class="label"><span class="label-text-alt">Number of species included in range filter. Updates automatically when threshold,
                  latitude, or longitude changes.</span></div> <!></div></div></div></div></div>`),bs=v('<div class="alert alert-info"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <span>SQLite is recommended database type for most users.</span></div> <div class="grid grid-cols-1 md:grid-cols-2 gap-6"><!></div>',1),ms=v('<div class="grid grid-cols-1 md:grid-cols-2 gap-6"><!> <!> <!> <!> <!></div>'),fs=v('<div class="space-y-4"><!> <!> <!></div>'),_s=v('<div class="space-y-6"><div><h4 class="text-lg font-medium pb-2">Dashboard</h4> <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6"><!></div> <div class="mt-4"><!> <!> <div><!></div> <!></div></div></div>'),xs=(c,t)=>m(t,!1),ws=(c,t)=>c.key==="Escape"&&m(t,!1),ys=(c,t)=>m(t,!1),ks=(c,t)=>m(t,null),Ss=v('<div class="alert alert-error mb-4"><svg class="stroke-current shrink-0 w-6 h-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <span> </span> <button type="button" class="btn btn-sm btn-ghost ml-auto" aria-label="Dismiss error"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>'),Ts=v('<div class="text-center py-8"><div class="loading loading-spinner loading-lg"></div> <p class="mt-2">Loading species...</p></div>'),Cs=v('<div class="p-2 rounded hover:bg-base-200"><div class="font-medium"> </div> <div class="text-sm text-base-content/70"> </div></div>'),Ls=v('<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2"></div>'),As=v('<div class="text-center py-8 text-base-content/60">No species found with current settings</div>'),Ms=(c,t)=>m(t,!1),Ds=v('<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" role="dialog" aria-modal="true" aria-labelledby="modal-title" tabindex="-1"><div class="bg-base-100 rounded-lg p-6 max-w-4xl max-h-[80vh] overflow-hidden flex flex-col" role="document"><div class="flex justify-between items-center mb-4"><h3 id="modal-title" class="text-lg font-bold">Range Filter Species</h3> <button type="button" class="btn btn-sm btn-circle btn-ghost" aria-label="Close modal"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div> <div class="mb-4 text-sm text-base-content/70"><div class="grid grid-cols-2 md:grid-cols-4 gap-4"><div><span class="font-medium">Species Count:</span> <span> </span></div> <div><span class="font-medium">Threshold:</span> <span> </span></div> <div><span class="font-medium">Latitude:</span> <span> </span></div> <div><span class="font-medium">Longitude:</span> <span> </span></div></div></div> <!> <div class="flex-1 overflow-auto"><!></div> <div class="flex justify-end items-center mt-4 pt-4 border-t"><button type="button" class="btn btn-outline">Close</button></div></div></div>'),Ps=v('<div class="space-y-4"><!> <!> <!> <!></div> <!>',1);function Bs(c,t){Ke(t,!0);const[d,N]=ft(),re=()=>$e(ga,"$nodeSettings",d),se=()=>$e(ha,"$birdnetSettings",d),s=()=>$e(Le,"$settingsStore",d);let i=p(()=>({main:re()||{name:""},birdnet:se()||{sensitivity:1,threshold:.8,overlap:0,locale:"en",threads:0,latitude:0,longitude:0,modelPath:"",labelPath:"",rangeFilter:{model:"latest",threshold:.01}},dynamicThreshold:se()?.dynamicThreshold||{enabled:!1,debug:!1,trigger:.8,min:.3,validHours:24},database:se()?.database||{type:"sqlite",path:"birds.db",host:"",port:3306,name:"",username:"",password:""},ui:{dashboard:{thumbnails:{summary:!0,recent:!0,imageProvider:"wikimedia",fallbackPolicy:"all"},summaryLimit:100}}})),g=p(s),ie=p(()=>Fe(e(g).originalData?.node,e(g).formData?.node)),oe=p(()=>Fe(e(g).originalData?.birdnet,e(g).formData?.birdnet)),Y=p(()=>Fe(e(g).originalData?.birdnet?.database,e(g).formData?.birdnet?.database)),P=p(()=>Fe(e(g).originalData?.ui,e(g).formData?.ui)),S=be(tt([])),L=be(tt([])),E=be(!1),T=be(null),M=be(!1),G=be(!1),z=be(null),I=be(!1),K=be(tt([])),J,k,b;Kt(async()=>{try{const l=await(await fetch("/api/v2/settings/locales")).json();m(S,Object.entries(l).map(([f,C])=>({value:f,label:C})),!0)}catch(o){console.error("Error fetching locales:",o)}try{console.log("Fetching image providers from /api/v2/settings/imageproviders...");const o=await fetch("/api/v2/settings/imageproviders");console.log("Image providers response status:",o.status),o.ok||console.error("Image providers response not OK:",o.status,o.statusText);const l=await o.json();console.log("Raw image providers data:",l),m(L,(l.providers||[]).map(f=>({value:f.value,label:f.display})),!0),console.log("Mapped provider options:",e(L)),m(E,e(L).length>1),console.log("Multiple providers available:",e(E))}catch(o){console.error("Error fetching image providers:",o)}U(),V()});async function V(){if(!J)return;const o=window.L;if(!o){console.error("Leaflet not loaded");return}const l=e(i).birdnet.latitude||0,f=e(i).birdnet.longitude||0,C=l!==0||f!==0?6:2;k=o.map(J).setView([l,f],C),o.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"}).addTo(k),(l!==0||f!==0)&&A(l,f),k.on("click",R=>{A(R.latlng.lat,R.latlng.lng),k.setView(R.latlng)})}function A(o,l){const f=window.L;if(!f||!k)return;const C=parseFloat(o.toFixed(3)),R=parseFloat(l.toFixed(3));O.updateSection("birdnet",{latitude:C,longitude:R}),b?b.setLatLng([o,l]):(b=f.marker([o,l],{draggable:!0}).addTo(k),b.on("dragend",W=>{A(W.target.getLatLng().lat,W.target.getLatLng().lng)})),w()}let ne;function w(){clearTimeout(ne),ne=setTimeout(()=>{Z()},500)}async function U(){try{const o=await fetch("/api/v2/range/species/count");if(!o.ok)throw new Error("Failed to load range filter count");const l=await o.json();m(T,l.count,!0)}catch(o){console.error("Failed to load range filter count:",o),m(z,"Failed to load species count")}}async function Z(){if(!(e(G)||!e(i).birdnet.latitude||!e(i).birdnet.longitude)){m(G,!0),m(z,null);try{const o=await fetch("/api/v2/range/species/test",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":window.CSRF_TOKEN||""},body:JSON.stringify({latitude:e(i).birdnet.latitude,longitude:e(i).birdnet.longitude,threshold:e(i).birdnet.rangeFilter.threshold})});if(!o.ok)throw new Error("Failed to test range filter");const l=await o.json();m(T,l.count,!0),e(I)&&m(K,l.species||[],!0)}catch(o){console.error("Failed to test range filter:",o),m(z,"Failed to test range filter settings")}finally{m(G,!1)}}}async function ae(){if(!e(M)){m(M,!0),m(z,null);try{const o=new URLSearchParams({latitude:e(i).birdnet.latitude.toString(),longitude:e(i).birdnet.longitude.toString(),threshold:e(i).birdnet.rangeFilter.threshold.toString()}),l=await fetch(`/api/v2/range/species/list?${o}`,{headers:{"X-CSRF-Token":window.CSRF_TOKEN||""}});if(!l.ok)throw new Error("Failed to load species list");const f=await l.json();m(K,f.species||[],!0),m(T,f.count,!0)}catch(o){console.error("Failed to load species list:",o),m(z,"Failed to load species list")}finally{m(M,!1)}}}yt(()=>{w()});function ue(o){O.updateSection("node",{name:o})}function me(o,l){O.updateSection("birdnet",{[o]:l})}function u(o,l){O.updateSection("birdnet",{dynamicThreshold:{...e(i).dynamicThreshold,[o]:l}})}function _(o){O.updateSection("birdnet",{database:{...e(i).database,type:o}})}function x(o){O.updateSection("birdnet",{database:{...e(i).database,path:o}})}function y(o,l){O.updateSection("birdnet",{database:{...e(i).database,[o]:l}})}function D(o,l){console.log("Dashboard setting update:",o,l)}function X(o,l){console.log("Thumbnail setting update:",o,l)}var ce=Ps();$t(o=>{var l=os();n(o,l)});var j=ze(ce),F=a(j);Re(F,{title:"Node Settings",description:"Configure node specific settings",defaultOpen:!0,get hasChanges(){return e(ie)},children:(o,l)=>{var f=ls(),C=a(f);const R=p(()=>e(g).isLoading||e(g).isSaving);Ve(C,{id:"node-name",label:"Node Name",placeholder:"Enter node name",helpText:"Node name is used to identify source system in multi node setup, also used as identifier for MQTT messages.",get disabled(){return e(R)},onchange:ue,get value(){return e(i).main.name},set value(W){e(i).main.name=W}}),n(o,f)},$$slots:{default:!0}});var pe=r(F,2);Re(pe,{title:"BirdNET Settings",description:"Configure BirdNET AI model specific settings",defaultOpen:!0,get hasChanges(){return e(oe)},children:(o,l)=>{var f=hs(),C=a(f),R=a(C);const W=p(()=>e(g).isLoading||e(g).isSaving);Qe(R,{label:"Sensitivity",get value(){return e(i).birdnet.sensitivity},onUpdate:ve=>me("sensitivity",ve),min:.5,max:1.5,step:.1,helpText:"Detection sensitivity. Higher values result in higher sensitivity. Values in 0.5, 1.5.",get disabled(){return e(W)}});var we=r(R,2);const ke=p(()=>e(g).isLoading||e(g).isSaving);Qe(we,{label:"Threshold",get value(){return e(i).birdnet.threshold},onUpdate:ve=>me("threshold",ve),min:.01,max:.99,step:.01,helpText:"Minimum confidence threshold. Values in 0.01, 0.99.",get disabled(){return e(ke)}});var ge=r(we,2);const Q=p(()=>e(g).isLoading||e(g).isSaving);Qe(ge,{label:"Overlap",get value(){return e(i).birdnet.overlap},onUpdate:ve=>me("overlap",ve),min:0,max:2.9,step:.1,helpText:"Overlap of prediction segments. Values in 0.0, 2.9.",get disabled(){return e(Q)}});var de=r(ge,2);const xe=p(()=>e(g).isLoading||e(g).isSaving);pt(de,{id:"locale",label:"Locale",get options(){return e(S)},helpText:"Locale for translated species common names.",get disabled(){return e(xe)},onchange:ve=>me("locale",ve),get value(){return e(i).birdnet.locale},set value(ve){e(i).birdnet.locale=ve}});var fe=r(de,2);const ye=p(()=>e(g).isLoading||e(g).isSaving);Qe(fe,{label:"TensorFlow CPU Threads",get value(){return e(i).birdnet.threads},onUpdate:ve=>me("threads",ve),min:0,max:32,step:1,helpText:"Number of CPU threads. Set to 0 to use all available threads.",get disabled(){return e(ye)}});var Se=r(C,2),he=r(a(Se),2),Be=a(he);const je=p(()=>e(g).isLoading||e(g).isSaving);Ve(Be,{id:"model-path",label:"Model Path (Requires restart to apply)",placeholder:"Path to model file",helpText:"Path to external BirdNET model file. Enter absolute or relative path to birdnet-go binary. Leave empty to use the default embedded model.",get disabled(){return e(je)},onchange:ve=>me("modelPath",ve),get value(){return e(i).birdnet.modelPath},set value(ve){e(i).birdnet.modelPath=ve}});var Te=r(Be,2);const He=p(()=>e(g).isLoading||e(g).isSaving);Ve(Te,{id:"label-path",label:"Label Path (Requires restart to apply)",placeholder:"Path to labels file",helpText:"Path to external model labels file, .zip or .txt file. Enter absolute or relative path to birdnet-go binary. Leave empty to use the default embedded labels.",get disabled(){return e(He)},onchange:ve=>me("labelPath",ve),get value(){return e(i).birdnet.labelPath},set value(ve){e(i).birdnet.labelPath=ve}});var We=r(Se,2),De=r(a(We),2);const ot=p(()=>e(g).isLoading||e(g).isSaving);Ee(De,{label:"Enable Dynamic Threshold (BirdNET-Go specific feature)",helpText:"Enables dynamic confidence threshold feature for more adaptive bird call detection.",get disabled(){return e(ot)},onchange:ve=>u("enabled",ve),get checked(){return e(i).dynamicThreshold.enabled},set checked(ve){e(i).dynamicThreshold.enabled=ve}});var Ce=r(De,2);{var _e=ve=>{var Ne=ds(),vt=a(Ne);const Pt=p(()=>e(g).isLoading||e(g).isSaving);Qe(vt,{label:"Trigger Threshold",get value(){return e(i).dynamicThreshold.trigger},onUpdate:Bt=>u("trigger",Bt),min:0,max:1,step:.01,helpText:"The confidence level at which the dynamic threshold is activated. If a bird call is detected with confidence over this value, the threshold for positive matches of that species will be lowered for subsequent calls.",get disabled(){return e(Pt)}});var jt=r(vt,2);const aa=p(()=>e(g).isLoading||e(g).isSaving);Qe(jt,{label:"Minimum Dynamic Threshold",get value(){return e(i).dynamicThreshold.min},onUpdate:Bt=>u("min",Bt),min:0,max:.99,step:.01,helpText:"The minimum value to which the dynamic threshold can be lowered. This ensures that the threshold does not drop below an unwanted level.",get disabled(){return e(aa)}});var sa=r(jt,2);const ra=p(()=>e(g).isLoading||e(g).isSaving);Qe(sa,{label:"Dynamic Threshold Expire Time (Hours)",get value(){return e(i).dynamicThreshold.validHours},onUpdate:Bt=>u("validHours",Bt),min:0,max:1e3,step:1,helpText:"The number of hours during which the dynamic threshold adjustments remain valid. After this period, the dynamic threshold is reset.",get disabled(){return e(ra)}}),n(ve,Ne)};h(Ce,ve=>{e(i).dynamicThreshold.enabled&&ve(_e)})}var Ie=r(We,2),et=r(a(Ie),2),qe=a(et),Ue=r(a(qe),2),st=a(Ue);Jt(st,ve=>J=ve,()=>J);var ct=r(qe,2),Ye=a(ct);const Ze=p(()=>e(g).isLoading||e(g).isSaving);Qe(Ye,{label:"Latitude",get value(){return e(i).birdnet.latitude},onUpdate:ve=>me("latitude",ve),min:-90,max:90,step:.001,helpText:"Station location latitude, used to limit bird species to those probable in the region.",get disabled(){return e(Ze)}});var lt=r(Ye,2);const gt=p(()=>e(g).isLoading||e(g).isSaving);Qe(lt,{label:"Longitude",get value(){return e(i).birdnet.longitude},onUpdate:ve=>me("longitude",ve),min:-180,max:180,step:.001,helpText:"Station location longitude, used to limit bird species to those probable in the region.",get disabled(){return e(gt)}});var dt=r(lt,2);const xt=p(()=>e(g).isLoading||e(g).isSaving);pt(dt,{id:"range-filter-model",label:"Range Filter Model",options:[{value:"legacy",label:"legacy"},{value:"latest",label:"latest"}],helpText:"BirdNET range filter model version: latest or legacy.",get disabled(){return e(xt)},onchange:ve=>O.updateSection("birdnet",{rangeFilter:{...e(i).birdnet.rangeFilter,model:ve}}),get value(){return e(i).birdnet.rangeFilter.model},set value(ve){e(i).birdnet.rangeFilter.model=ve}});var wt=r(dt,2);const Lt=p(()=>e(g).isLoading||e(g).isSaving);Qe(wt,{label:"Threshold",get value(){return e(i).birdnet.rangeFilter.threshold},onUpdate:ve=>O.updateSection("birdnet",{rangeFilter:{...e(i).birdnet.rangeFilter,threshold:ve}}),min:0,max:.99,step:.01,helpText:"Controls which species are included based on their occurrence probability for your location and time of year. Default (0.01) is recommended for most users. Higher values (0.05-0.3) include fewer species with higher occurrence probability. Very high values (0.5+) include only the most common species.",get disabled(){return e(Lt)}});var kt=r(wt,2),Et=r(a(kt),2),At=a(Et),Mt=a(At);let qt;var Ot=a(Mt),Ft=r(Mt,2);{var Ht=ve=>{var Ne=cs();n(ve,Ne)};h(Ft,ve=>{e(G)&&ve(Ht)})}var Dt=r(At,2);Dt.__click=[vs,I,ae];var Nt=a(Dt);{var Qt=ve=>{var Ne=us();n(ve,Ne)},zt=ve=>{var Ne=Xe("View Species");n(ve,Ne)};h(Nt,ve=>{e(M)?ve(Qt):ve(zt,!1)})}var Gt=r(Et,4);{var Vt=ve=>{var Ne=gs(),vt=r(a(Ne),2),Pt=a(vt),jt=r(vt,2);jt.__click=[ps,z],q(()=>ee(Pt,e(z))),n(ve,Ne)};h(Gt,ve=>{e(z)&&ve(Vt)})}q(ve=>{qt=Pe(Mt,1,"text-lg font-bold text-primary",null,qt,ve),ee(Ot,e(T)!==null?e(T):"Loading..."),Dt.disabled=!e(T)||e(M)},[()=>({"opacity-60":e(G)})]),n(o,f)},$$slots:{default:!0}});var le=r(pe,2);Re(le,{title:"Database Settings",description:"Detections database settings",defaultOpen:!0,get hasChanges(){return e(Y)},children:(o,l)=>{var f=fs(),C=a(f);const R=p(()=>e(g).isLoading||e(g).isSaving);pt(C,{id:"database-type",label:"Select Database Type",options:[{value:"sqlite",label:"SQLite"},{value:"mysql",label:"MySQL"}],helpText:"Select the database type to use for storing detections.",get disabled(){return e(R)},onchange:Q=>_(Q),get value(){return e(i).database.type},set value(Q){e(i).database.type=Q}});var W=r(C,2);{var we=Q=>{var de=bs(),xe=r(ze(de),2),fe=a(xe);const ye=p(()=>e(g).isLoading||e(g).isSaving);Ve(fe,{id:"sqlite-path",label:"SQLite Database Path",placeholder:"Enter SQLite database path",helpText:"SQLite database file path relative to the application directory",get disabled(){return e(ye)},onchange:x,get value(){return e(i).database.path},set value(Se){e(i).database.path=Se}}),n(Q,de)};h(W,Q=>{e(i).database.type==="sqlite"&&Q(we)})}var ke=r(W,2);{var ge=Q=>{var de=ms(),xe=a(de);const fe=p(()=>e(g).isLoading||e(g).isSaving);Ve(xe,{id:"mysql-host",label:"MySQL Host",placeholder:"Enter MySQL host",helpText:"MySQL database host (IP or hostname)",get disabled(){return e(fe)},onchange:De=>y("host",De),get value(){return e(i).database.host},set value(De){e(i).database.host=De}});var ye=r(xe,2);const Se=p(()=>e(g).isLoading||e(g).isSaving);Qe(ye,{label:"MySQL Port",get value(){return e(i).database.port},onUpdate:De=>y("port",De),min:1,max:65535,placeholder:"3306",helpText:"MySQL database port (default 3306/TCP)",get disabled(){return e(Se)}});var he=r(ye,2);const Be=p(()=>e(g).isLoading||e(g).isSaving);Ve(he,{id:"mysql-username",label:"MySQL Username",placeholder:"Enter MySQL username",helpText:"MySQL database username",get disabled(){return e(Be)},onchange:De=>y("username",De),get value(){return e(i).database.username},set value(De){e(i).database.username=De}});var je=r(he,2);const Te=p(()=>e(g).isLoading||e(g).isSaving);ht(je,{id:"mysql-password",get value(){return e(i).database.password},label:"MySQL Password",placeholder:"Enter MySQL password",helpText:"MySQL database password",get disabled(){return e(Te)},onUpdate:De=>y("password",De)});var He=r(je,2);const We=p(()=>e(g).isLoading||e(g).isSaving);Ve(He,{id:"mysql-database",label:"MySQL Database",placeholder:"Enter MySQL database name",helpText:"MySQL database name",get disabled(){return e(We)},onchange:De=>y("name",De),get value(){return e(i).database.name},set value(De){e(i).database.name=De}}),n(Q,de)};h(ke,Q=>{e(i).database.type==="mysql"&&Q(ge)})}n(o,f)},$$slots:{default:!0}});var B=r(le,2);Re(B,{title:"User Interface Settings",description:"Customize user interface",defaultOpen:!0,get hasChanges(){return e(P)},children:(o,l)=>{var f=_s(),C=a(f),R=r(a(C),2),W=a(R);const we=p(()=>e(g).isLoading||e(g).isSaving);Qe(W,{label:"Max Number of Species on Daily Summary Table",get value(){return e(i).ui.dashboard.summaryLimit},onUpdate:Te=>D("summaryLimit",Te),min:10,max:1e3,helpText:"Max number of species shown in the daily summary table (Value between 10 and 1000)",get disabled(){return e(we)}});var ke=r(R,2),ge=a(ke);const Q=p(()=>e(g).isLoading||e(g).isSaving);Ee(ge,{label:"Show Thumbnails on Daily Summary table",helpText:"Enable to show thumbnails of detected species on the daily summary table",get disabled(){return e(Q)},onchange:Te=>X("summary",Te),get checked(){return e(i).ui.dashboard.thumbnails.summary},set checked(Te){e(i).ui.dashboard.thumbnails.summary=Te}});var de=r(ge,2);const xe=p(()=>e(g).isLoading||e(g).isSaving);Ee(de,{label:"Show Thumbnails on Recent Detections list",helpText:"Enable to show thumbnails of detected species on the recent detections list",get disabled(){return e(xe)},onchange:Te=>X("recent",Te),get checked(){return e(i).ui.dashboard.thumbnails.recent},set checked(Te){e(i).ui.dashboard.thumbnails.recent=Te}});var fe=r(de,2);let ye;var Se=a(fe);const he=p(()=>e(g).isLoading||e(g).isSaving||!e(E));pt(Se,{id:"image-provider",label:"Image Provider",get options(){return e(L)},helpText:"Select the preferred image provider for bird thumbnails",get disabled(){return e(he)},onchange:Te=>X("imageProvider",Te),get value(){return e(i).ui.dashboard.thumbnails.imageProvider},set value(Te){e(i).ui.dashboard.thumbnails.imageProvider=Te}});var Be=r(fe,2);{var je=Te=>{const He=p(()=>e(g).isLoading||e(g).isSaving);pt(Te,{id:"fallback-policy",label:"Fallback Policy",options:[{value:"all",label:"Try all providers in sequence"},{value:"none",label:"Use only selected provider"}],helpText:"Select what happens when preferred provider fails to find an image",get disabled(){return e(He)},onchange:We=>X("fallbackPolicy",We),get value(){return e(i).ui.dashboard.thumbnails.fallbackPolicy},set value(We){e(i).ui.dashboard.thumbnails.fallbackPolicy=We}})};h(Be,Te=>{e(E)&&Te(je)})}q(Te=>ye=Pe(fe,1,"",null,ye,Te),[()=>({"opacity-50":!e(E)})]),n(o,f)},$$slots:{default:!0}});var H=r(j,2);{var $=o=>{var l=Ds();l.__click=[xs,I],l.__keydown=[ws,I];var f=a(l),C=a(f),R=r(a(C),2);R.__click=[ys,I];var W=r(C,2),we=a(W),ke=a(we),ge=r(a(ke),2),Q=a(ge),de=r(ke,2),xe=r(a(de),2),fe=a(xe),ye=r(de,2),Se=r(a(ye),2),he=a(Se),Be=r(ye,2),je=r(a(Be),2),Te=a(je),He=r(W,2);{var We=qe=>{var Ue=Ss(),st=r(a(Ue),2),ct=a(st),Ye=r(st,2);Ye.__click=[ks,z],q(()=>ee(ct,e(z))),n(qe,Ue)};h(He,qe=>{e(z)&&qe(We)})}var De=r(He,2),ot=a(De);{var Ce=qe=>{var Ue=Ts();n(qe,Ue)},_e=(qe,Ue)=>{{var st=Ye=>{var Ze=Ls();it(Ze,21,()=>e(K),nt,(lt,gt)=>{var dt=Cs(),xt=a(dt),wt=a(xt),Lt=r(xt,2),kt=a(Lt);q(()=>{ee(wt,e(gt).commonName),ee(kt,e(gt).scientificName)}),n(lt,dt)}),n(Ye,Ze)},ct=Ye=>{var Ze=As();n(Ye,Ze)};h(qe,Ye=>{e(K).length>0?Ye(st):Ye(ct,!1)},Ue)}};h(ot,qe=>{e(M)?qe(Ce):qe(_e,!1)})}var Ie=r(De,2),et=a(Ie);et.__click=[Ms,I],q(()=>{ee(Q,e(T)),ee(fe,e(i).birdnet.rangeFilter.threshold),ee(he,e(i).birdnet.latitude),ee(Te,e(i).birdnet.longitude)}),n(o,l)};h(H,o=>{e(I)&&o($)})}n(c,ce),Je(),N()}at(["click","keydown"]);var Is=v('<div class="flex items-center gap-2"><input type="text" class="input input-bordered input-sm flex-1" placeholder="rtsp://user:password@example.com/stream"/> <button type="button" class="btn btn-error btn-xs">Remove</button></div>'),Es=v('<div class="space-y-2"><!> <div class="flex items-center gap-2"><input type="text" class="input input-bordered input-sm flex-1" placeholder="Enter RTSP URL (rtsp://user:password@example.com/stream1)"/> <button type="button" class="btn btn-primary btn-sm">Add</button></div></div>');function qs(c,t){Ke(t,!0);let d=te(t,"urls",19,()=>[]),N=te(t,"disabled",3,!1),re=be("");function se(){if(e(re).trim()){const L=[...d(),{url:e(re).trim(),enabled:!0}];t.onUpdate(L),m(re,"")}}function s(L){const E=d().filter((T,M)=>M!==L);t.onUpdate(E)}function i(L,E){const T=[...d()];T[L]={...T[L],url:E},t.onUpdate(T)}function g(L){L.key==="Enter"&&(L.preventDefault(),se())}var ie=Es(),oe=a(ie);it(oe,17,d,nt,(L,E,T)=>{var M=Is(),G=a(M);G.__input=I=>i(T,I.currentTarget.value);var z=r(G,2);z.__click=()=>s(T),q(()=>{Yt(G,e(E).url),G.disabled=N(),z.disabled=N()}),n(L,M)});var Y=r(oe,2),P=a(Y),S=r(P,2);S.__click=se,q(L=>{P.disabled=N(),S.disabled=L},[()=>N()||!e(re).trim()]),Ge("keypress",P,g),Tt(P,()=>e(re),L=>m(re,L)),n(c,ie),Je()}at(["input","click"]);var Ns=v("<option> </option>"),zs=v("<option>No sound card capture</option> <!>",1),js=v('<div class="space-y-6"><div><h4 class="text-lg font-medium pb-2">Sound Card Source</h4> <!></div> <div><h4 class="text-lg font-medium pt-4 pb-2">RTSP Source</h4> <div class="mb-4"><!></div> <div class="form-control"><label class="label" for="rtsp-urls"><span class="label-text">RTSP Stream URLs</span></label> <div id="rtsp-urls"><!></div></div></div></div>'),Rs=v('<div class="space-y-4"><!></div>'),Us=v('<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4"><!></div> <div class="alert alert-info mt-4"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <div><p class="font-semibold">Sound Level Data Output</p> <p class="text-sm">When enabled, sound level measurements are published via:</p> <ul class="text-sm list-disc list-inside mt-1"><li>MQTT topic: <code></code></li> <li>SSE endpoint: <code>/api/v2/soundlevels/stream</code></li> <li>Prometheus metrics: <code>birdnet_sound_level_db</code></li></ul></div></div>',1),Os=v('<div class="space-y-4"><!> <!></div>'),Fs=v('<!> <div class="grid grid-cols-1 md:grid-cols-3 gap-6"><!> <!> <!></div>',1),Hs=v('<div class="space-y-4"><!> <!></div>'),Qs=v('<div class="grid grid-cols-1 md:grid-cols-2 gap-6"><!> <div class="mt-8"><!></div></div>'),Gs=v('<div class="space-y-4"><div class="grid grid-cols-1 md:grid-cols-2 gap-6"><!> <!> <!></div> <!></div>'),Vs=v('<div class="space-y-4"><!> <!> <!> <!> <!></div>');function Ws(c,t){Ke(t,!0);const[d,N]=ft(),re=()=>$e(ba,"$audioSettings",d),se=()=>$e(Le,"$settingsStore",d);let s=p(()=>re()||{source:"",rtsp:{transport:"tcp",urls:[]},soundLevel:{enabled:!1,interval:60},equalizer:{enabled:!1,filters:[]},export:{enabled:!1,debug:!1,path:"clips/",format:"wav",quality:"96k"},retention:{policy:"none",maxAge:"7d",maxUsage:"80%",minClips:10,keepSpectrograms:!1}}),i=p(se),g=p(()=>Fe({source:e(i).originalData?.audio?.source,rtsp:e(i).originalData?.audio?.rtsp},{source:e(i).formData?.audio?.source,rtsp:e(i).formData?.audio?.rtsp})),ie=p(()=>Fe(e(i).originalData?.audio?.export,e(i).formData?.audio?.export)),oe=p(()=>Fe(e(i).originalData?.audio?.export?.retention,e(i).formData?.audio?.export?.retention)),Y=p(()=>Fe(e(i).originalData?.audio?.equalizer,e(i).formData?.audio?.equalizer)),P=p(()=>Fe(e(i).originalData?.audio?.soundLevel,e(i).formData?.audio?.soundLevel)),S=be(tt([]));yt(()=>{fetch("/api/v1/settings/audio/get").then(u=>u.json()).then(u=>{m(S,u||[],!0)}).catch(u=>console.error("Error fetching audio devices:",u))});const L=[{value:"wav",label:"WAV"},{value:"flac",label:"FLAC"},{value:"aac",label:"AAC"},{value:"opus",label:"Opus"},{value:"mp3",label:"MP3"}],E=[{value:"none",label:"None"},{value:"age",label:"Age"},{value:"usage",label:"Usage"}];let T=p(()=>({policy:e(s).retention?.policy||"none",maxAge:e(s).retention?.maxAge||"7d",maxUsage:e(s).retention?.maxUsage||"80%",minClips:e(s).retention?.minClips||10,keepSpectrograms:e(s).retention?.keepSpectrograms||!1}));function M(u){O.updateSection("audio",{source:u})}function G(u){O.updateSection("audio",{rtsp:{...e(s).rtsp,transport:u}})}function z(u){O.updateSection("audio",{rtsp:{...e(s).rtsp,urls:u}})}function I(u){O.updateSection("audio",{export:{...e(s).export,enabled:u}})}function K(u){O.updateSection("audio",{export:{...e(s).export,format:u}})}function J(u){O.updateSection("audio",{export:{...e(s).export,quality:u}})}function k(u){O.updateSection("audio",{retention:{...e(T),policy:u}})}function b(u){O.updateSection("audio",{retention:{...e(T),maxAge:u}})}function V(u){!u.endsWith("%")&&!isNaN(Number(u))&&(u=u+"%"),O.updateSection("audio",{retention:{...e(T),maxUsage:u}})}function A(u){O.updateSection("audio",{retention:{...e(T),minClips:u}})}function ne(u){O.updateSection("audio",{retention:{...e(T),keepSpectrograms:u}})}var w=Vs(),U=a(w);Re(U,{title:"Audio Capture",description:"Set audio capture source, sound card or RTSP stream",defaultOpen:!0,get hasChanges(){return e(g)},children:(u,_)=>{var x=js(),y=a(x),D=r(a(y),2);const X=p(()=>e(i).isLoading||e(i).isSaving);pt(D,{id:"audio-source",label:"Audio Source (requires application restart to take effect)",placeholder:"No sound card capture",get disabled(){return e(X)},onchange:M,options:[],get value(){return e(s).source},set value(o){e(s).source=o},children:(o,l)=>{var f=zs(),C=ze(f);C.value=C.__value="";var R=r(C,2);it(R,17,()=>e(S),nt,(W,we)=>{var ke=Ns(),ge=a(ke),Q={};q(()=>{ee(ge,e(we).Name),Q!==(Q=e(we).Name)&&(ke.value=(ke.__value=e(we).Name)??"")}),n(W,ke)}),n(o,f)},$$slots:{default:!0}});var ce=r(y,2),j=r(a(ce),2),F=a(j);const pe=p(()=>e(i).isLoading||e(i).isSaving);pt(F,{id:"rtsp-transport",label:"RTSP Transport Protocol",options:[{value:"tcp",label:"TCP"},{value:"udp",label:"UDP"}],get disabled(){return e(pe)},onchange:o=>G(o),get value(){return e(s).rtsp.transport},set value(o){e(s).rtsp.transport=o}});var le=r(j,2),B=r(a(le),2),H=a(B);const $=p(()=>e(i).isLoading||e(i).isSaving);qs(H,{get urls(){return e(s).rtsp.urls},onUpdate:z,get disabled(){return e($)}}),n(u,x)},$$slots:{default:!0}});var Z=r(U,2);Re(Z,{title:"Audio Filters",description:"Configure audio processing filters",defaultOpen:!1,get hasChanges(){return e(Y)},children:(u,_)=>{var x=Rs(),y=a(x);const D=p(()=>e(i).isLoading||e(i).isSaving);Ee(y,{label:"Enable Audio Equalizer",get disabled(){return e(D)},onchange:()=>O.updateSection("audio",{equalizer:{...e(s).equalizer,enabled:e(s).equalizer.enabled}}),get checked(){return e(s).equalizer.enabled},set checked(X){e(s).equalizer.enabled=X}}),n(u,x)},$$slots:{default:!0}});var ae=r(Z,2);Re(ae,{title:"Sound Level Monitoring",description:"Monitor and report environmental sound levels",defaultOpen:!1,get hasChanges(){return e(P)},children:(u,_)=>{var x=Os(),y=a(x);const D=p(()=>e(i).isLoading||e(i).isSaving);Ee(y,{label:"Enable Sound Level Monitoring",get disabled(){return e(D)},onchange:()=>O.updateSection("audio",{soundLevel:{...e(s).soundLevel,enabled:e(s).soundLevel.enabled}}),get checked(){return e(s).soundLevel.enabled},set checked(j){e(s).soundLevel.enabled=j}});var X=r(y,2);{var ce=j=>{var F=Us(),pe=ze(F),le=a(pe);const B=p(()=>e(i).isLoading||e(i).isSaving);Qe(le,{label:"Measurement Interval (seconds)",get value(){return e(s).soundLevel.interval},onUpdate:C=>O.updateSection("audio",{soundLevel:{...e(s).soundLevel,interval:C}}),min:5,max:300,step:1,placeholder:"60",helpText:"How often to report sound level measurements",get disabled(){return e(B)}});var H=r(pe,2),$=r(a(H),2),o=r(a($),4),l=a(o),f=r(a(l));f.textContent="{base_topic}/soundlevel",n(j,F)};h(X,j=>{e(s).soundLevel.enabled&&j(ce)})}n(u,x)},$$slots:{default:!0}});var ue=r(ae,2);Re(ue,{title:"Audio Export",description:"Configure audio clip saving for identified bird calls",defaultOpen:!0,get hasChanges(){return e(ie)},children:(u,_)=>{var x=Hs(),y=a(x);const D=p(()=>e(i).isLoading||e(i).isSaving);Ee(y,{label:"Enable Audio Export",get disabled(){return e(D)},onchange:()=>I(e(s).export.enabled),get checked(){return e(s).export.enabled},set checked(j){e(s).export.enabled=j}});var X=r(y,2);{var ce=j=>{var F=Fs(),pe=ze(F);const le=p(()=>e(i).isLoading||e(i).isSaving);Ee(pe,{label:"Enable Debug Mode",get disabled(){return e(le)},onchange:()=>O.updateSection("audio",{export:{...e(s).export,debug:e(s).export.debug}}),get checked(){return e(s).export.debug},set checked(R){e(s).export.debug=R}});var B=r(pe,2),H=a(B);const $=p(()=>e(i).isLoading||e(i).isSaving);Ve(H,{id:"export-path",label:"Export Path",placeholder:"clips/",get disabled(){return e($)},onchange:R=>O.updateSection("audio",{export:{...e(s).export,path:R}}),get value(){return e(s).export.path},set value(R){e(s).export.path=R}});var o=r(H,2);const l=p(()=>e(i).isLoading||e(i).isSaving);pt(o,{id:"export-type",label:"Export Type",get options(){return L},get disabled(){return e(l)},onchange:R=>K(R),get value(){return e(s).export.format},set value(R){e(s).export.format=R}});var f=r(o,2);const C=p(()=>e(i).isLoading||e(i).isSaving||!1||!["aac","opus","mp3"].includes(e(s).export.format));Ve(f,{id:"export-bitrate",label:"Bitrate",placeholder:"96k",get disabled(){return e(C)},onchange:J,get value(){return e(s).export.quality},set value(R){e(s).export.quality=R}}),n(j,F)};h(X,j=>{e(s).export.enabled&&j(ce)})}n(u,x)},$$slots:{default:!0}});var me=r(ue,2);Re(me,{title:"Audio Clip Retention",description:"Configure audio clip cleanup",defaultOpen:!0,get hasChanges(){return e(oe)},children:(u,_)=>{var x=Gs(),y=a(x),D=a(y);const X=p(()=>e(i).isLoading||e(i).isSaving);pt(D,{id:"retention-policy",label:"Retention Policy",get options(){return E},get disabled(){return e(X)},onchange:k,get value(){return e(T).policy},set value(H){e(T).policy=H}});var ce=r(D,2);{var j=H=>{const $=p(()=>e(i).isLoading||e(i).isSaving);Ve(H,{id:"retention-max-age",label:"Max Age",placeholder:"7d",get disabled(){return e($)},onchange:b,get value(){return e(T).maxAge},set value(o){e(T).maxAge=o}})};h(ce,H=>{e(T).policy==="age"&&H(j)})}var F=r(ce,2);{var pe=H=>{const $=p(()=>e(i).isLoading||e(i).isSaving);Ve(H,{id:"retention-max-usage",label:"Max Usage (Percentage)",placeholder:"80%",get disabled(){return e($)},oninput:V,get value(){return e(T).maxUsage},set value(o){e(T).maxUsage=o}})};h(F,H=>{e(T).policy==="usage"&&H(pe)})}var le=r(y,2);{var B=H=>{var $=Qs(),o=a($);const l=p(()=>e(i).isLoading||e(i).isSaving);Qe(o,{label:"Minimum Clips",onUpdate:A,min:0,placeholder:"10",get disabled(){return e(l)},get value(){return e(T).minClips},set value(W){e(T).minClips=W}});var f=r(o,2),C=a(f);const R=p(()=>e(i).isLoading||e(i).isSaving);Ee(C,{label:"Keep Spectrogram Images",get disabled(){return e(R)},onchange:()=>ne(e(T).keepSpectrograms),get checked(){return e(T).keepSpectrograms},set checked(W){e(T).keepSpectrograms=W}}),n(H,$)};h(le,H=>{e(T).policy!=="none"&&H(B)})}n(u,x)},$$slots:{default:!0}}),n(c,w),Je(),N()}function Ks(c,t,d,N){const re=c.target;t(re.value),m(d,!1),N.onInput?.(re.value)}var Js=v('<span class="text-error ml-1">*</span>'),Ys=v('<button type="button" class="help-icon ml-1 text-info hover:text-info-focus transition-colors" aria-label="Help information">ⓘ</button>'),Zs=v('<label class="label justify-start"><span class="label-text capitalize"> <!></span> <!></label>'),Xs=Ct('<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>'),$s=(c,t,d)=>t(e(d)),er=v('<button type="button" class="species-prediction-item w-full text-left px-4 py-2 hover:bg-base-200 focus:bg-base-200 focus:outline-none border-none bg-transparent text-sm svelte-1iwzg4a" role="option" aria-selected="false" tabindex="-1"> </button>'),tr=v('<div id="species-predictions-list" class="absolute top-full left-0 right-0 z-50 bg-base-100 border border-base-300 rounded-lg shadow-lg mt-1 max-h-60 overflow-y-auto min-w-0 svelte-1iwzg4a" role="listbox" aria-label="Species suggestions"></div>'),ar=v('<span class="text-sm text-error mt-1"> </span>'),sr=v('<div class="label"><span class="label-text-alt text-base-content/70"> </span></div>'),rr=v('<div class="absolute z-50 p-2 mt-1 text-sm bg-base-300 border border-base-content/20 rounded shadow-lg max-w-xs" role="tooltip"> </div>'),ir=v('<div><!> <div class="relative"><div class="join w-full"><input type="text" autocomplete="off" role="combobox" aria-haspopup="listbox" aria-controls="species-predictions-list"/> <button type="button" aria-label="Add species"><!> </button></div> <!></div> <!> <!> <!></div>');function Rt(c,t){Ke(t,!0);let d=te(t,"value",15,""),N=te(t,"placeholder",3,"Add new species"),re=te(t,"disabled",3,!1),se=te(t,"required",3,!1),s=te(t,"size",3,"sm"),i=te(t,"predictions",19,()=>[]),g=te(t,"buttonText",3,"Add"),ie=te(t,"buttonIcon",3,!0),oe=te(t,"maxPredictions",3,10),Y=te(t,"minCharsForPredictions",3,2),P=te(t,"className",3,""),S=mt(t,["$$slots","$$events","$$legacy","value","label","id","placeholder","disabled","required","helpText","tooltip","size","validationMessage","predictions","buttonText","buttonIcon","buttonSize","maxPredictions","minCharsForPredictions","className","onInput","onAdd","onPredictionSelect"]),L=be(!1),E=be(!1),T=be(!1),M,G=p(()=>t.buttonSize||s()),z=p(()=>()=>!M||!e(T)?!0:M.validity.valid);const I={xs:"input-xs",sm:"input-sm",md:"",lg:"input-lg"},K={xs:"btn-xs",sm:"btn-sm",md:"",lg:"btn-lg"};let J=p(()=>d().length>=Y()&&i().length>0?i().filter(o=>o.toLowerCase().includes(d().toLowerCase())&&o!==d()).slice(0,oe()):[]);yt(()=>{m(L,e(J).length>0)});function k(){m(T,!0)}function b(){m(T,!0)}function V(o){o.key==="Enter"?(o.preventDefault(),A()):o.key==="Escape"?(o.preventDefault(),m(L,!1),M?.blur()):o.key==="ArrowDown"&&e(L)&&(o.preventDefault(),document.querySelector(".species-prediction-item")?.focus())}function A(){if(!d().trim()||re())return;const o=d().trim();t.onAdd?.(o),d(""),m(L,!1)}function ne(o){d(o),t.onPredictionSelect?.(o),m(L,!1),setTimeout(()=>{A()},0)}function w(o,l,f){o.key==="Enter"||o.key===" "?(o.preventDefault(),ne(l)):o.key==="ArrowDown"?(o.preventDefault(),document.querySelectorAll(".species-prediction-item")[f+1]?.focus()):o.key==="ArrowUp"?(o.preventDefault(),f===0?M?.focus():document.querySelectorAll(".species-prediction-item")[f-1]?.focus()):o.key==="Escape"&&(o.preventDefault(),m(L,!1),M?.focus())}function U(o){o.target.closest(".form-control")||m(L,!1)}yt(()=>(document.addEventListener("click",U),()=>{document.removeEventListener("click",U)}));var Z=ir();_t(Z,o=>({class:o,...S}),[()=>Ae("form-control relative",P())],"svelte-1iwzg4a");var ae=a(Z);{var ue=o=>{var l=Zs(),f=a(l),C=a(f),R=r(C);{var W=ge=>{var Q=Js();n(ge,Q)};h(R,ge=>{se()&&ge(W)})}var we=r(f,2);{var ke=ge=>{var Q=Ys();Ge("mouseenter",Q,()=>m(E,!0)),Ge("mouseleave",Q,()=>m(E,!1)),Ge("focus",Q,()=>m(E,!0)),Ge("blur",Q,()=>m(E,!1)),n(ge,Q)};h(we,ge=>{t.tooltip&&ge(ke)})}q(()=>{Me(l,"for",t.id),ee(C,`${t.label??""} `)}),n(o,l)};h(ae,o=>{t.label&&o(ue)})}var me=r(ae,2),u=a(me),_=a(u);_.__input=[Ks,d,T,t],_.__keydown=V,Jt(_,o=>M=o,()=>M);var x=r(_,2);x.__click=A;var y=a(x);{var D=o=>{var l=Xs();n(o,l)};h(y,o=>{ie()&&o(D)})}var X=r(y),ce=r(u,2);{var j=o=>{var l=tr();St(l,"",{},{"min-width":"100%"}),it(l,21,()=>e(J),nt,(f,C,R)=>{var W=er();W.__click=[$s,ne,C],W.__keydown=ke=>w(ke,e(C),R);var we=a(W);q(()=>ee(we,e(C))),n(f,W)}),n(o,l)};h(ce,o=>{e(L)&&e(J).length>0&&o(j)})}var F=r(me,2);{var pe=o=>{var l=ar(),f=a(l);q(()=>ee(f,t.validationMessage||`Please enter a valid ${t.label||"species"}`)),n(o,l)};h(F,o=>{!e(z)&&e(T)&&o(pe)})}var le=r(F,2);{var B=o=>{var l=sr(),f=a(l),C=a(f);q(()=>ee(C,t.helpText)),n(o,l)};h(le,o=>{t.helpText&&o(B)})}var H=r(le,2);{var $=o=>{var l=rr(),f=a(l);q(()=>ee(f,t.tooltip)),n(o,l)};h(H,o=>{t.tooltip&&e(E)&&o($)})}q((o,l,f)=>{Me(_,"id",t.id),Me(_,"placeholder",N()),_.disabled=re(),_.required=se(),Pe(_,1,o,"svelte-1iwzg4a"),Me(_,"aria-expanded",e(L)),Me(_,"aria-label",t.label||N()),Pe(x,1,l,"svelte-1iwzg4a"),x.disabled=f,ee(X,` ${g()??""}`)},[()=>Oe(Ae("input input-bordered join-item flex-1",I[s()],!e(z)&&"input-error")),()=>Oe(Ae("btn btn-primary join-item",K[e(G)])),()=>re()||!d().trim()]),Ge("blur",_,k),Ge("invalid",_,b),Ge("focus",_,()=>{e(J).length>0&&m(L,!0)}),Tt(_,d),n(c,Z),Je()}at(["input","keydown","click"]);function nr(c,t,d){c.key==="Enter"?(c.preventDefault(),t()):c.key==="Escape"&&(c.preventDefault(),d())}var or=v('<div class="grid grid-cols-1 md:grid-cols-2 gap-x-6"><!></div>'),lr=v('<div class="space-y-4"><!> <!></div>'),dr=v('<input type="text" class="input input-sm input-bordered flex-1" placeholder="Species name"/> <button type="button" class="btn btn-sm btn-success" aria-label="Save changes"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></button> <button type="button" class="btn btn-sm btn-ghost" aria-label="Cancel edit"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>',1),cr=v('<span class="flex-1 text-sm"> </span> <button type="button" class="btn btn-sm btn-ghost" aria-label="Edit species"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg></button> <button type="button" class="btn btn-sm btn-error" aria-label="Remove species"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button>',1),vr=v('<div class="flex items-center gap-2 p-3 bg-base-200 rounded-lg"><!></div>'),ur=v('<div class="space-y-2 mb-4"></div>'),pr=v('<div class="mt-2 text-xs text-info flex items-center gap-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <span>Unsaved changes</span></div>'),gr=v('<div class="grid grid-cols-1 md:grid-cols-2 gap-x-6"><!> <!></div> <div class="form-control mt-6"><div class="label justify-start"><span class="label-text">Dog Bark Species List</span> <div class="tooltip" data-tip="List of species to filter out as potential dog barks"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-info ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div></div> <!> <!> <!></div>',1),hr=v('<div class="space-y-4"><!> <!></div>'),br=v('<div class="space-y-4"><!> <!></div>');function mr(c,t){Ke(t,!0);const[d,N]=ft(),re=()=>$e(ma,"$filterSettings",d),se=()=>$e(Le,"$settingsStore",d);let s=p(()=>re()||{privacy:{enabled:!1,confidence:.5,debug:!1},dogBark:{enabled:!1,confidence:.5,remember:30,debug:!1,species:[]}}),i=p(se),g=p(()=>Fe(e(i).originalData?.filters?.privacy,e(i).formData?.filters?.privacy)),ie=p(()=>Fe(e(i).originalData?.filters?.dogBark,e(i).formData?.filters?.dogBark)),oe=be(""),Y=be(tt([])),P=be(null),S=be("");yt(()=>{fetch("/api/v2/range/species/list").then(w=>w.json()).then(w=>{w.species&&Array.isArray(w.species)&&m(Y,w.species.map(U=>U.label),!0)}).catch(w=>console.error("Failed to fetch species list:",w))});function L(w){O.updateSection("filters",{privacy:{...e(s).privacy,enabled:w}})}function E(w){O.updateSection("filters",{privacy:{...e(s).privacy,confidence:w}})}function T(w){O.updateSection("filters",{dogBark:{...e(s).dogBark,enabled:w}})}function M(w){O.updateSection("filters",{dogBark:{...e(s).dogBark,confidence:w}})}function G(w){O.updateSection("filters",{dogBark:{...e(s).dogBark,remember:w}})}function z(w){m(oe,w,!0)}function I(w){if(!w.trim())return;const U=w.trim();if(e(s).dogBark.species.includes(U))return;const Z=[...e(s).dogBark.species,U];O.updateSection("filters",{dogBark:{...e(s).dogBark,species:Z}})}function K(w){const U=e(s).dogBark.species.filter((Z,ae)=>ae!==w);O.updateSection("filters",{dogBark:{...e(s).dogBark,species:U}})}function J(w){m(P,w,!0),m(S,e(s).dogBark.species[w],!0)}function k(){if(e(P)===null||!e(S).trim())return;const w=[...e(s).dogBark.species];w[e(P)]=e(S).trim(),O.updateSection("filters",{dogBark:{...e(s).dogBark,species:w}}),b()}function b(){m(P,null),m(S,"")}var V=br(),A=a(V);Re(A,{title:"Privacy Filtering",description:"Privacy filtering avoids saving audio clips when human vocals are detected",defaultOpen:!0,get hasChanges(){return e(g)},children:(w,U)=>{var Z=lr(),ae=a(Z);const ue=p(()=>e(i).isLoading||e(i).isSaving);Ee(ae,{label:"Enable Privacy Filtering",get disabled(){return e(ue)},onchange:()=>L(e(s).privacy.enabled),get checked(){return e(s).privacy.enabled},set checked(_){e(s).privacy.enabled=_}});var me=r(ae,2);{var u=_=>{var x=or(),y=a(x);const D=p(()=>e(i).isLoading||e(i).isSaving);Qe(y,{label:"Confidence Threshold for Human Detection",get value(){return e(s).privacy.confidence},onUpdate:E,min:0,max:1,step:.01,get disabled(){return e(D)},helpText:"Set the confidence level for human voice detection, lower value makes filter more sensitive"}),n(_,x)};h(me,_=>{e(s).privacy.enabled&&_(u)})}n(w,Z)},$$slots:{default:!0}});var ne=r(A,2);Re(ne,{title:"False Positive Prevention",description:"Configure false detection filters",defaultOpen:!0,get hasChanges(){return e(ie)},children:(w,U)=>{var Z=hr(),ae=a(Z);const ue=p(()=>e(i).isLoading||e(i).isSaving);Ee(ae,{label:"Enable Dog Bark Filter",get disabled(){return e(ue)},onchange:()=>T(e(s).dogBark.enabled),get checked(){return e(s).dogBark.enabled},set checked(_){e(s).dogBark.enabled=_}});var me=r(ae,2);{var u=_=>{var x=gr(),y=ze(x),D=a(y);const X=p(()=>e(i).isLoading||e(i).isSaving);Qe(D,{label:"Confidence Threshold",get value(){return e(s).dogBark.confidence},onUpdate:M,min:0,max:1,step:.01,get disabled(){return e(X)},helpText:"Set the confidence level for dog bark detection, lower value makes filter more sensitive"});var ce=r(D,2);const j=p(()=>e(i).isLoading||e(i).isSaving);Qe(ce,{label:"Dog Bark Expire Time (Minutes)",get value(){return e(s).dogBark.remember},onUpdate:G,min:0,step:1,get disabled(){return e(j)},helpText:"Set how long to remember a detected dog bark"});var F=r(y,2),pe=r(a(F),2);{var le=l=>{var f=ur();it(f,21,()=>e(s).dogBark.species,nt,(C,R,W)=>{var we=vr(),ke=a(we);{var ge=de=>{var xe=dr(),fe=ze(xe);fe.__keydown=[nr,k,b];var ye=r(fe,2);ye.__click=k;var Se=r(ye,2);Se.__click=b,Tt(fe,()=>e(S),he=>m(S,he)),n(de,xe)},Q=de=>{var xe=cr(),fe=ze(xe),ye=a(fe),Se=r(fe,2);Se.__click=()=>J(W);var he=r(Se,2);he.__click=()=>K(W),q(()=>{ee(ye,e(R)),Se.disabled=e(i).isLoading||e(i).isSaving,he.disabled=e(i).isLoading||e(i).isSaving}),n(de,xe)};h(ke,de=>{e(P)===W?de(ge):de(Q,!1)})}n(C,we)}),n(l,f)};h(pe,l=>{e(s).dogBark.species.length>0&&l(le)})}var B=r(pe,2);const H=p(()=>e(i).isLoading||e(i).isSaving);Rt(B,{label:"Add Dog Bark Species",placeholder:"Type species name...",helpText:"Search and add species that might be confused with dog barks",get disabled(){return e(H)},get predictions(){return e(Y)},size:"sm",buttonText:"Add",buttonIcon:!0,onInput:z,onAdd:I,get value(){return e(oe)},set value(l){m(oe,l,!0)}});var $=r(B,2);{var o=l=>{var f=pr();n(l,f)};h($,l=>{e(ie)&&l(o)})}n(_,x)};h(me,_=>{e(s).dogBark.enabled&&_(u)})}n(w,Z)},$$slots:{default:!0}}),n(c,V),Je(),N()}at(["keydown","click"]);var fr=v('<div class="mb-6"><div class="flex justify-between text-sm mb-2"><span class="font-medium">Overall Progress</span> <span class="text-base-content/70"> </span></div> <div class="w-full bg-base-300 rounded-full h-2 overflow-hidden"><div class="bg-primary h-full transition-all duration-300 ease-out"></div></div></div>'),_r=v('<div class="absolute left-6 top-12 bottom-0 w-0.5 bg-base-300"></div>'),xr=(c,t,d)=>t(e(d).id),wr=v('<p class="text-sm text-base-content/70 mt-1"> </p>'),yr=v("<p> </p>"),kr=v('<div class="mt-2"><div class="w-full bg-base-300 rounded-full h-1.5 overflow-hidden"><div class="bg-info h-full transition-all duration-300 ease-out"></div></div></div>'),Sr=v('<div class="flex gap-4 pb-8 last:pb-0"><!> <div><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round"></path></svg></div> <div class="flex-1 pt-1"><button type="button"><h3> </h3> <!> <!> <!></button></div></div>'),Tr=v('<div class="relative"></div>'),Cr=(c,t,d)=>t(e(d).id),Lr=v("<div> </div>"),Ar=v('<div class="text-xs text-base-content/60"> </div>'),Mr=v('<button type="button"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round"></path></svg> <div class="flex-1 text-left"><div class="font-medium text-sm"> </div> <!></div> <!></button>'),Dr=v('<div class="space-y-2"></div>'),Pr=(c,t,d)=>t(e(d).id),Br=v('<p class="text-sm text-base-content/70 mt-1"> </p>'),Ir=v('<div class="alert alert-error mt-3"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <span class="text-sm"> </span></div>'),Er=v('<p class="text-sm text-base-content/60 mt-2"> </p>'),qr=v('<div class="mt-3"><div class="flex justify-between text-xs mb-1"><span class="text-base-content/60">Progress</span> <span class="text-base-content/70"> </span></div> <div class="w-full bg-base-300 rounded-full h-2 overflow-hidden"><div></div></div></div>'),Nr=v('<div><button type="button"><div class="flex items-start gap-4"><div><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round"></path></svg></div> <div class="flex-1"><div class="flex items-center justify-between"><h3 class="font-medium"> </h3> <span class="text-xs text-base-content/60"> </span></div> <!> <!> <!></div></div></button></div>'),zr=v('<div class="space-y-4"></div>'),jr=v("<div><!> <!></div>");function Wt(c,t){Ke(t,!0);let d=te(t,"stages",19,()=>[]);te(t,"currentStageId",3,null);let N=te(t,"className",3,""),re=te(t,"showProgress",3,!0),se=te(t,"variant",3,"default"),s=p(()=>()=>{const M=d().filter(z=>z.status==="completed").length,G=d().filter(z=>z.status!=="skipped").length;return G>0?Math.round(M/G*100):0});function i(M){switch(M){case"completed":return"M5 13l4 4L19 7";case"error":return"M6 18L18 6M6 6l12 12";case"in_progress":return"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z";case"skipped":return"M8 7h8m-8 5h4m1 8l-5-5-5 5V5a2 2 0 012-2h11a2 2 0 012 2v15z";default:return"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"}}function g(M){switch(M){case"completed":return"text-success";case"error":return"text-error";case"in_progress":return"text-info";case"skipped":return"text-base-content/50";default:return"text-base-content/30"}}function ie(M){switch(M){case"completed":return"bg-success";case"error":return"bg-error";case"in_progress":return"bg-info";default:return"bg-base-300"}}function oe(M){t.onStageClick&&t.onStageClick(M)}var Y=jr(),P=a(Y);{var S=M=>{var G=fr(),z=a(G),I=r(a(z),2),K=a(I),J=r(z,2),k=a(J);let b;q((V,A)=>{ee(K,`${V??""}%`),b=St(k,"",b,A)},[()=>e(s)(),()=>({width:`${e(s)()??""}%`})]),n(M,G)};h(P,M=>{re()&&se()!=="compact"&&M(S)})}var L=r(P,2);{var E=M=>{var G=Tr();it(G,21,d,nt,(z,I,K)=>{var J=Sr(),k=a(J);{var b=D=>{var X=_r();n(D,X)};h(k,D=>{K<d().length-1&&D(b)})}var V=r(k,2),A=a(V),ne=a(A),w=r(V,2),U=a(w);U.__click=[xr,oe,I];var Z=a(U),ae=a(Z),ue=r(Z,2);{var me=D=>{var X=wr(),ce=a(X);q(()=>ee(ce,e(I).description)),n(D,X)};h(ue,D=>{e(I).description&&D(me)})}var u=r(ue,2);{var _=D=>{var X=yr(),ce=a(X);q(j=>{Pe(X,1,j),ee(ce,e(I).message)},[()=>Oe(Ae("text-sm mt-2",e(I).status==="error"?"text-error":"text-base-content/60"))]),n(D,X)};h(u,D=>{e(I).message&&D(_)})}var x=r(u,2);{var y=D=>{var X=kr(),ce=a(X),j=a(ce);let F;q(pe=>F=St(j,"",F,pe),[()=>({width:`${e(I).progress??""}%`})]),n(D,X)};h(x,D=>{e(I).status==="in_progress"&&e(I).progress!==void 0&&D(y)})}q((D,X,ce,j,F)=>{Pe(V,1,D),Pe(A,0,X),Me(ne,"d",ce),U.disabled=!t.onStageClick,Pe(U,1,j),Pe(Z,1,F),ee(ae,e(I).title)},[()=>Oe(Ae("relative z-10 flex-shrink-0 w-12 h-12 rounded-full flex items-center justify-center transition-colors",e(I).status==="completed"?"bg-success/20":e(I).status==="error"?"bg-error/20":e(I).status==="in_progress"?"bg-info/20":"bg-base-200")),()=>Oe(Ae("w-6 h-6",g(e(I).status))),()=>i(e(I).status),()=>Oe(Ae("text-left w-full",t.onStageClick&&"hover:bg-base-200 rounded-lg p-2 -m-2 transition-colors")),()=>Oe(Ae("font-medium",e(I).status==="in_progress"?"text-primary":""))]),n(z,J)}),n(M,G)},T=(M,G)=>{{var z=K=>{var J=Dr();it(J,21,d,nt,(k,b)=>{var V=Mr();V.__click=[Cr,oe,b];var A=a(V),ne=a(A),w=r(A,2),U=a(w),Z=a(U),ae=r(U,2);{var ue=_=>{var x=Lr(),y=a(x);q(D=>{Pe(x,1,D),ee(y,e(b).message)},[()=>Oe(Ae("text-xs mt-0.5",e(b).status==="error"?"text-error":"text-base-content/60"))]),n(_,x)};h(ae,_=>{e(b).message&&_(ue)})}var me=r(w,2);{var u=_=>{var x=Ar(),y=a(x);q(()=>ee(y,`${e(b).progress??""}%`)),n(_,x)};h(me,_=>{e(b).status==="in_progress"&&e(b).progress!==void 0&&_(u)})}q((_,x,y)=>{V.disabled=!t.onStageClick,Pe(V,1,_),Pe(A,0,x),Me(ne,"d",y),ee(Z,e(b).title)},[()=>Oe(Ae("flex items-center gap-3 w-full p-3 rounded-lg transition-colors",e(b).status==="in_progress"?"bg-base-200":"",t.onStageClick&&"hover:bg-base-200")),()=>Oe(Ae("w-5 h-5 flex-shrink-0",g(e(b).status))),()=>i(e(b).status)]),n(k,V)}),n(K,J)},I=K=>{var J=zr();it(J,21,d,nt,(k,b,V)=>{var A=Nr(),ne=a(A);ne.__click=[Pr,oe,b];var w=a(ne),U=a(w),Z=a(U),ae=a(Z),ue=r(U,2),me=a(ue),u=a(me),_=a(u),x=r(u,2),y=a(x),D=r(me,2);{var X=B=>{var H=Br(),$=a(H);q(()=>ee($,e(b).description)),n(B,H)};h(D,B=>{e(b).description&&B(X)})}var ce=r(D,2);{var j=B=>{var H=Ir(),$=r(a(H),2),o=a($);q(()=>ee(o,e(b).error)),n(B,H)},F=(B,H)=>{{var $=o=>{var l=Er(),f=a(l);q(()=>ee(f,e(b).message)),n(o,l)};h(B,o=>{e(b).message&&o($)},H)}};h(ce,B=>{e(b).error?B(j):B(F,!1)})}var pe=r(ce,2);{var le=B=>{var H=qr(),$=a(H),o=r(a($),2),l=a(o),f=r($,2),C=a(f);let R;q((W,we)=>{ee(l,`${e(b).progress??""}%`),Pe(C,1,W),R=St(C,"",R,we)},[()=>Oe(Ae("h-full transition-all duration-300 ease-out",ie(e(b).status))),()=>({width:`${e(b).progress??""}%`})]),n(B,H)};h(pe,B=>{e(b).status==="in_progress"&&e(b).progress!==void 0&&B(le)})}q((B,H,$,o,l)=>{Pe(A,1,B),ne.disabled=!t.onStageClick,Pe(ne,1,H),Pe(U,1,$),Pe(Z,0,o),Me(ae,"d",l),ee(_,e(b).title),ee(y,`Step ${V+1} of ${d().length??""}`)},[()=>Oe(Ae("card",e(b).status==="in_progress"?"ring-2 ring-primary":"")),()=>Oe(Ae("card-body p-4 text-left w-full",t.onStageClick&&"hover:bg-base-200 transition-colors")),()=>Oe(Ae("flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center",e(b).status==="completed"?"bg-success/20":e(b).status==="error"?"bg-error/20":e(b).status==="in_progress"?"bg-info/20":"bg-base-200")),()=>Oe(Ae("w-5 h-5",g(e(b).status))),()=>i(e(b).status)]),n(k,A)}),n(K,J)};h(M,K=>{se()==="compact"?K(z):K(I,!1)},G)}};h(L,M=>{se()==="timeline"?M(E):M(T,!1)})}q(M=>Pe(Y,1,M),[()=>Oe(Ae("multi-stage-operation",N()))]),n(c,Y),Je()}at(["click"]);async function Rr(c,t){t.birdweather.isRunning=!0,t.birdweather.stages=[{id:"starting",title:"Starting Test",status:"in_progress"},{id:"connectivity",title:"API Connectivity",status:"pending"},{id:"auth",title:"Authentication",status:"pending"},{id:"upload",title:"Soundscape Upload",status:"pending"},{id:"detection",title:"Detection Post",status:"pending"}];try{for(let d=0;d<t.birdweather.stages.length;d++)t.birdweather.stages[d].status="in_progress",await new Promise(N=>setTimeout(N,800)),t.birdweather.stages[d].status="completed",t.birdweather.stages[d].message="Success"}catch{const d=t.birdweather.stages.find(N=>N.status==="in_progress");d&&(d.status="error",d.error="Test failed")}finally{t.birdweather.isRunning=!1,setTimeout(()=>{t.birdweather.stages=[]},5e3)}}async function Ur(c,t){t.mqtt.isRunning=!0,t.mqtt.stages=[{id:"starting",title:"Starting Test",status:"in_progress"},{id:"service",title:"Service Check",status:"pending"},{id:"start",title:"Service Start",status:"pending"},{id:"dns",title:"DNS Resolution",status:"pending"},{id:"tcp",title:"TCP Connection",status:"pending"},{id:"mqtt",title:"MQTT Connection",status:"pending"},{id:"publish",title:"Message Publishing",status:"pending"}];try{for(let d=0;d<t.mqtt.stages.length;d++)t.mqtt.stages[d].status="in_progress",await new Promise(N=>setTimeout(N,600)),t.mqtt.stages[d].status="completed",t.mqtt.stages[d].message="Success"}catch{const d=t.mqtt.stages.find(N=>N.status==="in_progress");d&&(d.status="error",d.error="Test failed")}finally{t.mqtt.isRunning=!1,setTimeout(()=>{t.mqtt.stages=[]},5e3)}}async function Or(c,t){t.weather.isRunning=!0,t.weather.stages=[{id:"starting",title:"Starting Test",status:"in_progress"},{id:"connectivity",title:"API Connectivity",status:"pending"},{id:"auth",title:"Authentication",status:"pending"},{id:"fetch",title:"Weather Data Fetch",status:"pending"},{id:"parse",title:"Data Parsing",status:"pending"}];try{for(let d=0;d<t.weather.stages.length;d++)t.weather.stages[d].status="in_progress",await new Promise(N=>setTimeout(N,700)),t.weather.stages[d].status="completed",t.weather.stages[d].message="Success"}catch{const d=t.weather.stages.find(N=>N.status==="in_progress");d&&(d.status="error",d.error="Test failed")}finally{t.weather.isRunning=!1,setTimeout(()=>{t.weather.stages=[]},5e3)}}var Fr=v('<div class="loading loading-spinner loading-sm"></div> Testing...',1),Hr=v('<div class="grid grid-cols-1 md:grid-cols-2 gap-6"><!> <!></div> <!> <div class="space-y-4"><div class="flex items-center gap-3"><button type="button" class="btn btn-outline btn-sm"><!></button> <span class="text-sm text-base-content/70"><!></span></div> <!></div>',1),Qr=v('<div class="space-y-4"><!> <!> <!></div>'),Gr=v(`<!> <div class="alert alert-info"><svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <div><span><strong>TLS Configuration:</strong><br/>• Standard TLS: Leave certificates
                    empty for public brokers<br/>• Self-signed certificates: Provide CA Certificate<br/>• Mutual TLS (mTLS): Provide all three certificates</span></div></div>`,1),Vr=v('<div class="loading loading-spinner loading-sm"></div> Testing...',1),Wr=v(`<div class="space-y-4"><!> <!> <div class="border-t border-base-300 pt-4 mt-2"><h3 class="text-sm font-medium mb-3">Authentication</h3> <div class="grid grid-cols-1 md:grid-cols-2 gap-4"><!> <!></div></div> <div class="border-t border-base-300 pt-4 mt-2"><h3 class="text-sm font-medium mb-3">Message Settings</h3> <div class="alert alert-info"><svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <span><strong>Home Assistant Users:</strong> It's recommended to enable the retain flag for
                Home Assistant integration. Without retain, MQTT sensors will appear as 'unknown' when
                Home Assistant restarts.</span></div></div> <div class="border-t border-base-300 pt-4 mt-2"><h3 class="text-sm font-medium mb-3">TLS/SSL Security</h3> <!> <!></div> <div class="space-y-4"><div class="flex items-center gap-3"><button type="button" class="btn btn-outline btn-sm"><!></button> <span class="text-sm text-base-content/70"><!></span></div> <!></div></div>`),Kr=v('<div class="space-y-4"><!> <!></div>'),Jr=v('<div class="grid grid-cols-1 md:grid-cols-2 gap-6"><!></div>'),Yr=v('<div class="space-y-4"><!> <!></div>'),Zr=v('<div class="alert alert-info"><svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <span>No weather data will be retrieved.</span></div>'),Xr=v(`<div class="alert alert-success"><svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path></svg> <div><p>Weather forecast data is provided by Yr.no, a joint service by the Norwegian
              Meteorological Institute (met.no) and the Norwegian Broadcasting Corporation (NRK).</p> <p class="mt-2">Yr is a free weather data service. For more information, visit <a href="https://hjelp.yr.no/hc/en-us/articles/206550539-Facts-about-Yr" class="link link-primary" target="_blank" rel="noopener noreferrer">Yr.no</a>.</p></div></div>`),$r=v('<div class="alert alert-info"><svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <span>Use of OpenWeather requires an API key, sign up for a free API key at <a href="https://home.openweathermap.org/users/sign_up" class="link link-primary" target="_blank" rel="noopener noreferrer">OpenWeather</a>.</span></div> <!>',1),ei=v('<div class="loading loading-spinner loading-sm"></div> Testing...',1),ti=v('<div class="space-y-4"><div class="flex items-center gap-3"><button type="button" class="btn btn-outline btn-sm"><!></button> <span class="text-sm text-base-content/70"><!></span></div> <!></div>'),ai=v('<div class="space-y-4"><!> <!> <!></div>'),si=v('<div class="space-y-4"><!> <!> <!> <!></div>');function ri(c,t){Ke(t,!0);const[d,N]=ft(),re=()=>$e(fa,"$integrationSettings",d),se=()=>$e(Le,"$settingsStore",d);let s=p(()=>re()||{birdweather:{enabled:!1,id:"",latitude:0,longitude:0,locationAccuracy:1e3,threshold:.7,debug:!1},mqtt:{enabled:!1,broker:"",port:1883,username:"",password:"",topic:"birdnet",tls:{enabled:!1,skipVerify:!1}},observability:{prometheus:{enabled:!1,port:9090,path:"/metrics"}},weather:{provider:"none",apiKey:"",enabled:!1}}),i=p(se),g=p(()=>Fe(e(i).originalData?.integration?.birdweather,e(i).formData?.integration?.birdweather)),ie=p(()=>Fe(e(i).originalData?.integration?.mqtt,e(i).formData?.integration?.mqtt)),oe=p(()=>Fe(e(i).originalData?.integration?.observability,e(i).formData?.integration?.observability)),Y=p(()=>Fe(e(i).originalData?.integration?.weather,e(i).formData?.integration?.weather)),P=tt({birdweather:{stages:[],isRunning:!1},mqtt:{stages:[],isRunning:!1},weather:{stages:[],isRunning:!1}});const S=[{value:"none",label:"None"},{value:"yr.no",label:"Yr.no"},{value:"openweather",label:"OpenWeather"}];function L(u){O.updateSection("integration",{birdweather:{...e(s).birdweather,enabled:u}})}function E(u){O.updateSection("integration",{birdweather:{...e(s).birdweather,id:u}})}function T(u){O.updateSection("integration",{birdweather:{...e(s).birdweather,threshold:u}})}function M(u){O.updateSection("integration",{birdweather:{...e(s).birdweather,debug:u}})}function G(u){O.updateSection("integration",{mqtt:{...e(s).mqtt,enabled:u}})}function z(u){O.updateSection("integration",{mqtt:{...e(s).mqtt,broker:u}})}function I(u){O.updateSection("integration",{mqtt:{...e(s).mqtt,topic:u}})}function K(u){O.updateSection("integration",{mqtt:{...e(s).mqtt,username:u}})}function J(u){O.updateSection("integration",{mqtt:{...e(s).mqtt,password:u}})}function k(u){O.updateSection("integration",{mqtt:{...e(s).mqtt,tls:{...e(s).mqtt.tls,enabled:u}}})}function b(u){O.updateSection("integration",{mqtt:{...e(s).mqtt,tls:{...e(s).mqtt.tls,skipVerify:u}}})}function V(u){O.updateSection("integration",{observability:{...e(s).observability,prometheus:{...e(s).observability.prometheus,enabled:u}}})}function A(u){const _=u.split(":"),x=_.length>1&&parseInt(_[1])||9090;O.updateSection("integration",{observability:{...e(s).observability,prometheus:{...e(s).observability.prometheus,port:x}}})}function ne(u){O.updateSection("integration",{weather:{...e(s).weather,provider:u}})}function w(u){O.updateSection("integration",{weather:{...e(s).weather,apiKey:u}})}var U=si(),Z=a(U);Re(Z,{title:"BirdWeather",description:"Upload detections to BirdWeather",defaultOpen:!0,get hasChanges(){return e(g)},children:(u,_)=>{var x=Qr(),y=a(x);h(y,F=>{});var D=r(y,2);const X=p(()=>e(i).isLoading||e(i).isSaving);Ee(D,{label:"Enable BirdWeather Uploads",get disabled(){return e(X)},onchange:()=>L(e(s).birdweather.enabled),get checked(){return e(s).birdweather.enabled},set checked(F){e(s).birdweather.enabled=F}});var ce=r(D,2);{var j=F=>{var pe=Hr(),le=ze(pe),B=a(le);const H=p(()=>e(i).isLoading||e(i).isSaving);ht(B,{label:"BirdWeather token",get value(){return e(s).birdweather.id},onUpdate:E,placeholder:"",helpText:"Your unique BirdWeather token.",get disabled(){return e(H)},allowReveal:!0});var $=r(B,2);const o=p(()=>e(i).isLoading||e(i).isSaving);Qe($,{label:"Upload Threshold",get value(){return e(s).birdweather.threshold},onUpdate:T,min:0,max:1,step:.01,placeholder:"0.7",helpText:"Minimum confidence threshold for uploading predictions to BirdWeather.",get disabled(){return e(o)}});var l=r(le,2);const f=p(()=>e(i).isLoading||e(i).isSaving);Ee(l,{label:"Enable Debug Mode",get disabled(){return e(f)},onchange:()=>M(e(s).birdweather.debug),get checked(){return e(s).birdweather.debug},set checked(he){e(s).birdweather.debug=he}});var C=r(l,2),R=a(C),W=a(R);W.__click=[Rr,P];var we=a(W);{var ke=he=>{var Be=Fr();n(he,Be)},ge=he=>{var Be=Xe("Test BirdWeather Connection");n(he,Be)};h(we,he=>{P.birdweather.isRunning?he(ke):he(ge,!1)})}var Q=r(W,2),de=a(Q);{var xe=he=>{var Be=Xe("BirdWeather must be enabled to test");n(he,Be)},fe=(he,Be)=>{{var je=He=>{var We=Xe("BirdWeather token must be specified");n(He,We)},Te=(He,We)=>{{var De=Ce=>{var _e=Xe("Test in progress...");n(Ce,_e)},ot=Ce=>{var _e=Xe("Test BirdWeather connection");n(Ce,_e)};h(He,Ce=>{P.birdweather.isRunning?Ce(De):Ce(ot,!1)},We)}};h(he,He=>{e(s).birdweather.id?He(Te,!1):He(je)},Be)}};h(de,he=>{e(s).birdweather.enabled?he(fe,!1):he(xe)})}var ye=r(R,2);{var Se=he=>{Wt(he,{get stages(){return P.birdweather.stages},variant:"compact",showProgress:!1})};h(ye,he=>{P.birdweather.stages.length>0&&he(Se)})}q(()=>W.disabled=!e(s).birdweather.enabled||!e(s).birdweather.id||P.birdweather.isRunning),n(F,pe)};h(ce,F=>{e(s).birdweather.enabled&&F(j)})}n(u,x)},$$slots:{default:!0}});var ae=r(Z,2);Re(ae,{title:"MQTT",description:"Configure MQTT broker connection",defaultOpen:!1,get hasChanges(){return e(ie)},children:(u,_)=>{var x=Kr(),y=a(x);const D=p(()=>e(i).isLoading||e(i).isSaving);Ee(y,{label:"Enable MQTT Integration",get disabled(){return e(D)},onchange:()=>G(e(s).mqtt.enabled),get checked(){return e(s).mqtt.enabled},set checked(j){e(s).mqtt.enabled=j}});var X=r(y,2);{var ce=j=>{var F=Wr(),pe=a(F);const le=p(()=>e(i).isLoading||e(i).isSaving);Ve(pe,{id:"mqtt-broker",label:"MQTT Broker",placeholder:"mqtt://localhost:1883",get disabled(){return e(le)},onchange:z,get value(){return e(s).mqtt.broker},set value(_e){e(s).mqtt.broker=_e}});var B=r(pe,2);const H=p(()=>e(i).isLoading||e(i).isSaving);Ve(B,{id:"mqtt-topic",label:"MQTT Topic",placeholder:"birdnet/detections",get disabled(){return e(H)},onchange:I,get value(){return e(s).mqtt.topic},set value(_e){e(s).mqtt.topic=_e}});var $=r(B,2),o=r(a($),2),l=a(o);const f=p(()=>e(s).mqtt.username||""),C=p(()=>e(i).isLoading||e(i).isSaving);Ve(l,{id:"mqtt-username",get value(){return e(f)},label:"Username",placeholder:"",get disabled(){return e(C)},onchange:_e=>K(_e)});var R=r(l,2);const W=p(()=>e(s).mqtt.password||""),we=p(()=>e(i).isLoading||e(i).isSaving);ht(R,{label:"Password",get value(){return e(W)},onUpdate:J,placeholder:"",helpText:"The MQTT password.",get disabled(){return e(we)},allowReveal:!0});var ke=r($,4),ge=r(a(ke),2);const Q=p(()=>e(i).isLoading||e(i).isSaving);Ee(ge,{label:"Enable TLS/SSL",get disabled(){return e(Q)},onchange:()=>k(e(s).mqtt.tls.enabled),get checked(){return e(s).mqtt.tls.enabled},set checked(_e){e(s).mqtt.tls.enabled=_e}});var de=r(ge,2);{var xe=_e=>{var Ie=Gr(),et=ze(Ie);const qe=p(()=>e(i).isLoading||e(i).isSaving);Ee(et,{label:"Skip Certificate Verification",get disabled(){return e(qe)},onchange:()=>b(e(s).mqtt.tls.skipVerify),get checked(){return e(s).mqtt.tls.skipVerify},set checked(Ue){e(s).mqtt.tls.skipVerify=Ue}}),n(_e,Ie)};h(de,_e=>{e(s).mqtt.tls.enabled&&_e(xe)})}var fe=r(ke,2),ye=a(fe),Se=a(ye);Se.__click=[Ur,P];var he=a(Se);{var Be=_e=>{var Ie=Vr();n(_e,Ie)},je=_e=>{var Ie=Xe("Test MQTT Connection");n(_e,Ie)};h(he,_e=>{P.mqtt.isRunning?_e(Be):_e(je,!1)})}var Te=r(Se,2),He=a(Te);{var We=_e=>{var Ie=Xe("MQTT must be enabled to test");n(_e,Ie)},De=(_e,Ie)=>{{var et=Ue=>{var st=Xe("MQTT broker must be specified");n(Ue,st)},qe=(Ue,st)=>{{var ct=Ze=>{var lt=Xe("Test in progress...");n(Ze,lt)},Ye=Ze=>{var lt=Xe("Test MQTT connection");n(Ze,lt)};h(Ue,Ze=>{P.mqtt.isRunning?Ze(ct):Ze(Ye,!1)},st)}};h(_e,Ue=>{e(s).mqtt.broker?Ue(qe,!1):Ue(et)},Ie)}};h(He,_e=>{e(s).mqtt.enabled?_e(De,!1):_e(We)})}var ot=r(ye,2);{var Ce=_e=>{Wt(_e,{get stages(){return P.mqtt.stages},variant:"compact",showProgress:!1})};h(ot,_e=>{P.mqtt.stages.length>0&&_e(Ce)})}q(()=>Se.disabled=!e(s).mqtt.enabled||!e(s).mqtt.broker||P.mqtt.isRunning),n(j,F)};h(X,j=>{e(s).mqtt.enabled&&j(ce)})}n(u,x)},$$slots:{default:!0}});var ue=r(ae,2);Re(ue,{title:"Observability",description:"Monitor BirdNET-Go's performance and bird detection metrics through Prometheus-compatible endpoint",defaultOpen:!1,get hasChanges(){return e(oe)},children:(u,_)=>{var x=Yr(),y=a(x);const D=p(()=>e(i).isLoading||e(i).isSaving);Ee(y,{label:"Enable Observability Integration",get disabled(){return e(D)},onchange:()=>V(e(s).observability.prometheus.enabled),get checked(){return e(s).observability.prometheus.enabled},set checked(j){e(s).observability.prometheus.enabled=j}});var X=r(y,2);{var ce=j=>{var F=Jr(),pe=a(F);const le=p(()=>`0.0.0.0:${e(s).observability.prometheus.port}`),B=p(()=>e(i).isLoading||e(i).isSaving);Ve(pe,{id:"observability-listen",get value(){return e(le)},label:"Listen Address",placeholder:"0.0.0.0:8090",get disabled(){return e(B)},onchange:A}),n(j,F)};h(X,j=>{e(s).observability.prometheus.enabled&&j(ce)})}n(u,x)},$$slots:{default:!0}});var me=r(ue,2);Re(me,{title:"Weather",description:"Configure weather data collection",defaultOpen:!1,get hasChanges(){return e(Y)},children:(u,_)=>{var x=ai(),y=a(x);const D=p(()=>e(i).isLoading||e(i).isSaving);pt(y,{id:"weather-provider",label:"Weather Provider",get options(){return S},get disabled(){return e(D)},onchange:ne,get value(){return e(s).weather.provider},set value(le){e(s).weather.provider=le}});var X=r(y,2);{var ce=le=>{var B=Zr();n(le,B)},j=(le,B)=>{{var H=o=>{var l=Xr();n(o,l)},$=(o,l)=>{{var f=C=>{var R=$r(),W=r(ze(R),2);const we=p(()=>e(s).weather.apiKey||""),ke=p(()=>e(i).isLoading||e(i).isSaving);ht(W,{label:"API Key",get value(){return e(we)},onUpdate:w,placeholder:"",helpText:"Your OpenWeather API key. Keep this secret!",get disabled(){return e(ke)},allowReveal:!0}),n(C,R)};h(o,C=>{e(s).weather.provider==="openweather"&&C(f)},l)}};h(le,o=>{e(s).weather.provider==="yr.no"?o(H):o($,!1)},B)}};h(X,le=>{e(s).weather.provider==="none"?le(ce):le(j,!1)})}var F=r(X,2);{var pe=le=>{var B=ti(),H=a(B),$=a(H);$.__click=[Or,P];var o=a($);{var l=Q=>{var de=ei();n(Q,de)},f=Q=>{var de=Xe("Test Weather Provider");n(Q,de)};h(o,Q=>{P.weather.isRunning?Q(l):Q(f,!1)})}var C=r($,2),R=a(C);{var W=Q=>{var de=Xe("No weather provider selected");n(Q,de)},we=(Q,de)=>{{var xe=ye=>{var Se=Xe("OpenWeather API key must be specified");n(ye,Se)},fe=(ye,Se)=>{{var he=je=>{var Te=Xe("Test in progress...");n(je,Te)},Be=je=>{var Te=Xe("Test weather provider connection");n(je,Te)};h(ye,je=>{P.weather.isRunning?je(he):je(Be,!1)},Se)}};h(Q,ye=>{e(s).weather.provider==="openweather"&&!e(s).weather.apiKey?ye(xe):ye(fe,!1)},de)}};h(R,Q=>{e(s).weather.provider==="none"?Q(W):Q(we,!1)})}var ke=r(H,2);{var ge=Q=>{Wt(Q,{get stages(){return P.weather.stages},variant:"compact",showProgress:!1})};h(ke,Q=>{P.weather.stages.length>0&&Q(ge)})}q(()=>$.disabled=e(s).weather.provider==="none"||e(s).weather.provider==="openweather"&&!e(s).weather.apiKey||P.weather.isRunning),n(le,B)};h(F,le=>{e(s).weather.provider!=="none"&&le(pe)})}n(u,x)},$$slots:{default:!0}}),n(c,U),Je(),N()}at(["click"]);function ii(c,t){c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),t())}function ni(c,t){const d=c.target;m(t,d.value,!0)}var oi=v('<div class="text-error text-sm mb-2"> </div>'),li=v('<div class="label"><span class="label-text-alt"> </span></div>'),di=v('<div class="text-error text-sm ml-2"> </div>'),ci=v('<div class="flex items-center gap-2 p-2 bg-base-200 rounded-lg"><input type="text"/> <button type="button" class="btn btn-ghost btn-sm btn-square text-error" aria-label="Remove subnet"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div> <!>',1),vi=v('<div class="space-y-2 mt-2"><div class="text-sm font-medium text-base-content/70"> </div> <!></div>'),ui=v('<div class="text-center py-4 text-base-content/50 bg-base-200 rounded-lg mt-2"><div class="text-sm">No subnets configured</div> <div class="text-xs">Add subnet ranges to allow bypass authentication</div></div>'),pi=v('<div class="alert alert-warning mt-2"><svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path></svg> <span> </span></div>'),gi=v('<div class="label"><span class="label-text-alt text-error"> </span></div>'),hi=v('<div><label class="label"><span class="label-text font-medium"> </span></label> <div class="flex gap-2 mb-3"><input type="text"/> <button type="button" class="btn btn-primary" aria-label="Add subnet"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg> Add</button></div> <!> <!> <!> <!> <!></div>');function bi(c,t){Ke(t,!0);let d=te(t,"helpText",3,""),N=te(t,"disabled",3,!1),re=te(t,"className",3,""),se=te(t,"placeholder",3,"192.168.1.0/24"),s=te(t,"maxItems",3,10),i=mt(t,["$$slots","$$events","$$legacy","label","subnets","onUpdate","helpText","disabled","error","className","placeholder","maxItems"]),g=be(""),ie=`subnet-${Math.random().toString(36).substring(2,11)}`,oe=be(tt({}));function Y(_){if(!_||_.trim().length===0)return"Subnet cannot be empty";const x=_.trim();if(!/^(\d{1,3}\.){3}\d{1,3}\/\d{1,2}$/.test(x))return"Invalid CIDR format. Use format like 192.168.1.0/24";const[D,X]=x.split("/"),ce=parseInt(X,10);if(ce<0||ce>32)return"Prefix length must be between 0 and 32";const j=D.split(".");for(const F of j){const pe=parseInt(F,10);if(isNaN(pe)||pe<0||pe>255)return"Invalid IP address. Each octet must be 0-255"}return null}function P(){const _=e(g).trim();if(!_||Y(_)||t.subnets.includes(_)||t.subnets.length>=s())return;const y=[...t.subnets,_];t.onUpdate(y),m(g,"")}function S(_){const x=t.subnets.filter((D,X)=>X!==_);t.onUpdate(x);const y={...e(oe)};delete y[_],m(oe,y,!0)}function L(_,x){const y=[...t.subnets];y[_]=x;const D=Y(x);if(D)e(oe)[_]=D;else{const X={...e(oe)};delete X[_],m(oe,X,!0)}t.onUpdate(y)}let E=p(()=>e(g).trim()?Y(e(g).trim()):null),T=p(()=>e(g).trim().length>0&&!e(E)&&!t.subnets.includes(e(g).trim())&&t.subnets.length<s());var M=hi();_t(M,_=>({class:_,...i}),[()=>Ae("form-control",re())]);var G=a(M),z=a(G),I=a(z),K=r(G,2),J=a(K);J.__keydown=[ii,P],J.__input=[ni,g];var k=r(J,2);k.__click=P;var b=r(K,2);{var V=_=>{var x=oi(),y=a(x);q(()=>ee(y,e(E))),n(_,x)};h(b,_=>{e(E)&&_(V)})}var A=r(b,2);{var ne=_=>{var x=li(),y=a(x),D=a(y);q(()=>{Me(x,"id",`${ie}-help`),ee(D,d())}),n(_,x)};h(A,_=>{d()&&_(ne)})}var w=r(A,2);{var U=_=>{var x=vi(),y=a(x),D=a(y),X=r(y,2);it(X,17,()=>t.subnets,nt,(ce,j,F)=>{var pe=ci(),le=ze(pe),B=a(le);B.__input=l=>L(F,l.target?.value||"");var H=r(B,2);H.__click=()=>S(F);var $=r(le,2);{var o=l=>{var f=di(),C=a(f);q(()=>ee(C,e(oe)[F])),n(l,f)};h($,l=>{e(oe)[F]&&l(o)})}q(l=>{Yt(B,e(j)),B.disabled=N(),Pe(B,1,l),H.disabled=N()},[()=>Oe(Ae("input input-sm input-bordered flex-1",e(oe)[F]?"input-error":""))]),n(ce,pe)}),q(()=>ee(D,`Allowed Subnets (${t.subnets.length??""}/${s()??""}):`)),n(_,x)},Z=_=>{var x=ui();n(_,x)};h(w,_=>{t.subnets.length>0?_(U):_(Z,!1)})}var ae=r(w,2);{var ue=_=>{var x=pi(),y=r(a(x),2),D=a(y);q(()=>ee(D,`Maximum number of subnets (${s()??""}) reached.`)),n(_,x)};h(ae,_=>{t.subnets.length>=s()&&_(ue)})}var me=r(ae,2);{var u=_=>{var x=gi(),y=a(x),D=a(y);q(()=>ee(D,t.error)),n(_,x)};h(me,_=>{t.error&&_(u)})}q(_=>{Me(G,"for",ie),ee(I,t.label),Me(J,"id",ie),Me(J,"placeholder",se()),J.disabled=N(),Pe(J,1,_),Me(J,"aria-describedby",d()?`${ie}-help`:void 0),k.disabled=N()||!e(T)},[()=>Oe(Ae("input input-bordered flex-1",e(E)?"input-error":""))]),Tt(J,()=>e(g),_=>m(g,_)),n(c,M),Je()}at(["keydown","input","click"]);var mi=v(`<div class="alert alert-info mt-4"><svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <div><h4 class="font-bold">AutoTLS Requirements:</h4> <ul class="text-sm list-disc list-inside mt-1"><li>A registered domain name is required</li> <li>Domain must point to this server's public IP</li> <li>Ports 80 and 443 must be accessible from the internet</li></ul></div></div>`),fi=v('<div class="space-y-4"><!> <div class="border-t border-base-300 pt-4 mt-4"><h4 class="text-lg font-medium mb-2">HTTPS Settings</h4> <p class="text-sm text-base-content/70 mb-4">Secure access with SSL/TLS encryption</p> <!> <!></div></div>'),_i=v('<div class="grid grid-cols-1 md:grid-cols-2 gap-6"><!></div>'),xi=v('<div class="space-y-4"><!> <!></div>'),wi=v('<div class="mt-4 space-y-4"><div class="bg-base-200 p-3 rounded-lg"><div class="text-sm"><p class="font-medium mb-1">Redirect URI for Google Cloud Console:</p> <code class="text-xs bg-base-300 px-2 py-1 rounded"> </code></div> <a href="https://console.cloud.google.com/apis/credentials" target="_blank" rel="noopener" class="text-sm text-primary hover:text-primary-focus inline-flex items-center mt-2">Get your credentials from Google Cloud Console <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" viewBox="0 0 20 20" fill="currentColor"><path d="M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z"></path><path d="M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z"></path></svg></a></div> <div class="grid grid-cols-1 md:grid-cols-2 gap-4"><!> <!></div> <!></div>'),yi=v('<div class="mt-4 space-y-4"><div class="bg-base-200 p-3 rounded-lg"><div class="text-sm"><p class="font-medium mb-1">Redirect URI for GitHub Developer Settings:</p> <code class="text-xs bg-base-300 px-2 py-1 rounded"> </code></div> <a href="https://github.com/settings/developers" target="_blank" rel="noopener" class="text-sm text-primary hover:text-primary-focus inline-flex items-center mt-2">Get your credentials from GitHub Developer Settings <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" viewBox="0 0 20 20" fill="currentColor"><path d="M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z"></path><path d="M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z"></path></svg></a></div> <div class="grid grid-cols-1 md:grid-cols-2 gap-4"><!> <!></div> <!></div>'),ki=v('<div class="space-y-6"><div class="border border-base-300 rounded-lg p-4"><h4 class="text-lg font-medium mb-4 flex items-center gap-3"><svg class="w-6 h-6" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"></path><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"></path><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"></path><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"></path></svg> Google OAuth</h4> <!> <!></div> <div class="border border-base-300 rounded-lg p-4"><h4 class="text-lg font-medium mb-4 flex items-center gap-3"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0C5.374 0 0 5.373 0 12 0 17.302 3.438 21.8 8.207 23.387c.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"></path></svg> GitHub OAuth</h4> <!> <!></div></div>'),Si=v(`<div class="ml-7"><!></div> <div class="alert alert-warning"><svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg> <span><strong>Security Warning:</strong> Devices from these subnets will have unrestricted access.
            Only include trusted internal networks.</span></div>`,1),Ti=v('<div class="space-y-4"><!> <!></div>'),Ci=v('<div class="space-y-4"><!> <!> <!> <!></div>');function Li(c,t){Ke(t,!0);const[d,N]=ft(),re=()=>$e(_a,"$securitySettings",d),se=()=>$e(Le,"$settingsStore",d);let s=p(()=>re()||{autoTLS:{enabled:!1,host:""},basicAuth:{enabled:!1,username:"",password:""},googleAuth:{enabled:!1,clientId:"",clientSecret:"",userId:""},githubAuth:{enabled:!1,clientId:"",clientSecret:"",userId:""},allowSubnetBypass:{enabled:!1,subnets:[]}}),i=p(se),g=p(()=>Fe({autoTLS:e(i).originalData?.security?.autoTLS},{autoTLS:e(i).formData?.security?.autoTLS})),ie=p(()=>Fe(e(i).originalData?.security?.basicAuth,e(i).formData?.security?.basicAuth)),oe=p(()=>Fe({googleAuth:e(i).originalData?.security?.googleAuth,githubAuth:e(i).originalData?.security?.githubAuth},{googleAuth:e(i).formData?.security?.googleAuth,githubAuth:e(i).formData?.security?.githubAuth})),Y=p(()=>Fe(e(i).originalData?.security?.allowSubnetBypass,e(i).formData?.security?.allowSubnetBypass)),P=p(()=>typeof window<"u"?window.location.origin:e(s).autoTLS.host?`https://${e(s).autoTLS.host}`:"https://your-domain.com"),S=p(()=>`${e(P)}/auth/google/callback`),L=p(()=>`${e(P)}/auth/github/callback`);function E(u){O.updateSection("security",{autoTLS:{...e(s).autoTLS,enabled:u}})}function T(u){O.updateSection("security",{autoTLS:{...e(s).autoTLS,host:u}})}function M(u){O.updateSection("security",{basicAuth:{...e(s).basicAuth,enabled:u}})}function G(u){O.updateSection("security",{basicAuth:{...e(s).basicAuth,password:u}})}function z(u){O.updateSection("security",{googleAuth:{...e(s).googleAuth,enabled:u}})}function I(u){O.updateSection("security",{googleAuth:{...e(s).googleAuth,clientId:u}})}function K(u){O.updateSection("security",{googleAuth:{...e(s).googleAuth,clientSecret:u}})}function J(u){O.updateSection("security",{googleAuth:{...e(s).googleAuth,userId:u}})}function k(u){O.updateSection("security",{githubAuth:{...e(s).githubAuth,enabled:u}})}function b(u){O.updateSection("security",{githubAuth:{...e(s).githubAuth,clientId:u}})}function V(u){O.updateSection("security",{githubAuth:{...e(s).githubAuth,clientSecret:u}})}function A(u){O.updateSection("security",{githubAuth:{...e(s).githubAuth,userId:u}})}function ne(u){O.updateSection("security",{allowSubnetBypass:{...e(s).allowSubnetBypass,enabled:u}})}function w(u){O.updateSection("security",{allowSubnetBypass:{...e(s).allowSubnetBypass,subnets:u}})}var U=Ci(),Z=a(U);Re(Z,{title:"Server Configuration",description:"Configure HTTPS and SSL/TLS settings",defaultOpen:!0,get hasChanges(){return e(g)},children:(u,_)=>{var x=fi(),y=a(x);const D=p(()=>e(i).isLoading||e(i).isSaving);Ve(y,{id:"host-address",label:"Host Address",placeholder:"For example, localhost:8080 or example.domain.com",get disabled(){return e(D)},onchange:()=>T(e(s).autoTLS.host),get value(){return e(s).autoTLS.host},set value(le){e(s).autoTLS.host=le}});var X=r(y,2),ce=r(a(X),4);const j=p(()=>e(i).isLoading||e(i).isSaving);Ee(ce,{label:"Auto SSL Certificate Management (AutoTLS)",get disabled(){return e(j)},onchange:()=>E(e(s).autoTLS.enabled),get checked(){return e(s).autoTLS.enabled},set checked(le){e(s).autoTLS.enabled=le}});var F=r(ce,2);{var pe=le=>{var B=mi();n(le,B)};h(F,le=>{e(s).autoTLS.enabled&&le(pe)})}n(u,x)},$$slots:{default:!0}});var ae=r(Z,2);Re(ae,{title:"Basic Authentication",description:"Secure access with a simple password",defaultOpen:!1,get hasChanges(){return e(ie)},children:(u,_)=>{var x=xi(),y=a(x);const D=p(()=>e(i).isLoading||e(i).isSaving);Ee(y,{label:"Enable Password Authentication",get disabled(){return e(D)},onchange:()=>M(e(s).basicAuth.enabled),get checked(){return e(s).basicAuth.enabled},set checked(j){e(s).basicAuth.enabled=j}});var X=r(y,2);{var ce=j=>{var F=_i(),pe=a(F);const le=p(()=>e(i).isLoading||e(i).isSaving);ht(pe,{label:"Password",get value(){return e(s).basicAuth.password},onUpdate:G,placeholder:"",helpText:"Limit access to settings with a password.",get disabled(){return e(le)},allowReveal:!0}),n(j,F)};h(X,j=>{e(s).basicAuth.enabled&&j(ce)})}n(u,x)},$$slots:{default:!0}});var ue=r(ae,2);Re(ue,{title:"OAuth2 Social Authentication",description:"Single sign-on to log in with your existing account",defaultOpen:!1,get hasChanges(){return e(oe)},children:(u,_)=>{var x=ki(),y=a(x),D=r(a(y),2);const X=p(()=>e(i).isLoading||e(i).isSaving);Ee(D,{label:"Allow OAuth2 Login via Google",get disabled(){return e(X)},onchange:()=>z(e(s).googleAuth.enabled),get checked(){return e(s).googleAuth.enabled},set checked($){e(s).googleAuth.enabled=$}});var ce=r(D,2);{var j=$=>{var o=wi(),l=a(o),f=a(l),C=r(a(f),2),R=a(C),W=r(l,2),we=a(W);const ke=p(()=>e(i).isLoading||e(i).isSaving);ht(we,{label:"Client ID",get value(){return e(s).googleAuth.clientId},onUpdate:I,placeholder:"",helpText:"The OAuth 2.0 Client ID obtained from Google Cloud Console when setting up OAuth credentials.",get disabled(){return e(ke)},allowReveal:!0});var ge=r(we,2);const Q=p(()=>e(i).isLoading||e(i).isSaving);ht(ge,{label:"Client Secret",get value(){return e(s).googleAuth.clientSecret},onUpdate:K,placeholder:"",helpText:"The OAuth 2.0 Client Secret obtained from Google Cloud Console when setting up OAuth credentials.",get disabled(){return e(Q)},allowReveal:!0});var de=r(W,2);const xe=p(()=>e(i).isLoading||e(i).isSaving);Ve(de,{id:"google-user-id",label:"User ID",placeholder:"Enter one or more allowed user emails",get disabled(){return e(xe)},onchange:()=>J(e(s).googleAuth.userId||""),get value(){return e(s).googleAuth.userId},set value(fe){e(s).googleAuth.userId=fe}}),q(()=>ee(R,e(S))),n($,o)};h(ce,$=>{e(s).googleAuth.enabled&&$(j)})}var F=r(y,2),pe=r(a(F),2);const le=p(()=>e(i).isLoading||e(i).isSaving);Ee(pe,{label:"Allow OAuth2 Login via GitHub",get disabled(){return e(le)},onchange:()=>k(e(s).githubAuth.enabled),get checked(){return e(s).githubAuth.enabled},set checked($){e(s).githubAuth.enabled=$}});var B=r(pe,2);{var H=$=>{var o=yi(),l=a(o),f=a(l),C=r(a(f),2),R=a(C),W=r(l,2),we=a(W);const ke=p(()=>e(i).isLoading||e(i).isSaving);ht(we,{label:"Client ID",get value(){return e(s).githubAuth.clientId},onUpdate:b,placeholder:"",helpText:"The OAuth 2.0 Client ID obtained from GitHub Developer Settings when setting up OAuth credentials.",get disabled(){return e(ke)},allowReveal:!0});var ge=r(we,2);const Q=p(()=>e(i).isLoading||e(i).isSaving);ht(ge,{label:"Client Secret",get value(){return e(s).githubAuth.clientSecret},onUpdate:V,placeholder:"",helpText:"The OAuth 2.0 Client Secret obtained from GitHub Developer Settings when setting up OAuth credentials.",get disabled(){return e(Q)},allowReveal:!0});var de=r(W,2);const xe=p(()=>e(i).isLoading||e(i).isSaving);Ve(de,{id:"github-user-id",label:"User ID",placeholder:"Enter one or more allowed user emails",get disabled(){return e(xe)},onchange:()=>A(e(s).githubAuth.userId||""),get value(){return e(s).githubAuth.userId},set value(fe){e(s).githubAuth.userId=fe}}),q(()=>ee(R,e(L))),n($,o)};h(B,$=>{e(s).githubAuth.enabled&&$(H)})}n(u,x)},$$slots:{default:!0}});var me=r(ue,2);Re(me,{title:"Bypass Authentication",description:"Allow access to settings without authentication",defaultOpen:!1,get hasChanges(){return e(Y)},children:(u,_)=>{var x=Ti(),y=a(x);const D=p(()=>e(i).isLoading||e(i).isSaving);Ee(y,{label:"Allow Access from Subnet to Bypass Authentication",get disabled(){return e(D)},onchange:()=>ne(e(s).allowSubnetBypass.enabled),get checked(){return e(s).allowSubnetBypass.enabled},set checked(j){e(s).allowSubnetBypass.enabled=j}});var X=r(y,2);{var ce=j=>{var F=Si(),pe=ze(F),le=a(pe);const B=p(()=>e(i).isLoading||e(i).isSaving);bi(le,{label:"",get subnets(){return e(s).allowSubnetBypass.subnets},onUpdate:w,placeholder:"Enter a CIDR subnet (e.g. 192.168.1.0/24)",helpText:"Allowed network ranges to bypass the login (CIDR notation, comma-separated list)",get disabled(){return e(B)},maxItems:5}),n(j,F)};h(X,j=>{e(s).allowSubnetBypass.enabled&&j(ce)})}n(u,x)},$$slots:{default:!0}}),n(c,U),Je(),N()}async function Ai(c,t){try{await navigator.clipboard.writeText(e(t))}catch(d){console.error("Failed to copy system ID:",d)}}async function Mi(c,t,d,N,re,se,s){m(t,!0),m(d,""),m(N,"info"),m(re,0),se("Preparing support dump...","info",10);try{const i=await fetch("/api/v2/support/generate",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"same-origin",body:JSON.stringify({include_logs:s.includeLogs,include_config:s.includeConfig,include_system_info:s.includeSystemInfo,user_message:s.userMessage,upload_to_sentry:s.uploadToSentry})});if(!i.ok)throw new Error(`Server error: ${i.status} ${i.statusText}`);const g=await i.json();m(t,!1),g.success?(s.uploadToSentry&&g.uploaded_at?(se("Support dump successfully uploaded to developers!","success",100),g.dump_id&&m(d,e(d)+` Reference ID: ${g.dump_id}`)):g.download_url?(se("Support dump generated successfully! Downloading...","success",100),setTimeout(()=>{window.location.href=g.download_url},500)):se("Support dump generated successfully!","success",100),setTimeout(()=>{m(d,""),m(N,"info"),m(re,0)},1e4)):se("Failed to generate support dump: "+(g.message||"Unknown error"),"error",0)}catch(i){m(t,!1),se("Error: "+i.message,"error",0)}}var Di=v(`<div class="grid grid-cols-1 gap-4 mt-4"><div class="alert alert-success"><svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <div><h3 class="font-bold">Error Tracking Enabled</h3> <div class="text-sm mt-1"><p>BirdNET-Go will now automatically report errors to help developers identify and
                  fix issues in BirdNET-Go.</p> <p class="mt-2">Your errors will be tagged with your System ID shown above.</p></div></div></div></div>`),Pi=v(`<div class="space-y-4"><div class="alert alert-info shadow-sm"><svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <div><h3 class="font-bold">Privacy-First Error Tracking</h3> <div class="text-sm mt-1"><p>Error tracking is <strong>completely optional</strong> and requires your explicit consent.
              When enabled:</p> <ul class="list-disc list-inside mt-2 space-y-1"><li>Only essential error information is collected for debugging</li> <li>No personal data, audio recordings, or bird detection data is sent</li> <li>All data is filtered to remove sensitive information</li> <li>Telemetry data helps developers identify and fix issues in BirdNET-Go</li></ul></div></div></div> <!> <div class="form-control w-full mt-4"><label class="label" for="systemID"><span class="label-text">Your System ID</span> <div class="tooltip" data-tip="This unique identifier helps developers track errors from your system. Share this ID when reporting issues on GitHub if you want your telemetry data to be identifiable for debugging."><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-info" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div></label> <div class="join"><input type="text" id="systemID" class="input input-sm input-bordered join-item w-full font-mono text-base-content" readonly=""/> <button type="button" class="btn btn-sm join-item"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg> Copy</button></div> <div class="label"><span class="label-text-alt text-base-content/60">Include this ID when reporting issues if you want developers to identify your error
            reports</span></div></div> <!></div>`),Bi=v('<div class="mt-4"><!> <div class="pl-6 mt-2 space-y-2"><div class="text-xs text-base-content/60"><p class="flex items-start gap-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> Data is uploaded to <a href="https://sentry.io" target="_blank" class="link link-primary">Sentry</a> cloud service</p> <p class="flex items-start gap-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> Stored in EU data center (Frankfurt, Germany)</p> <p class="flex items-start gap-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg> Privacy-compliant with sensitive data removed</p></div> <div class="text-xs text-warning/80 flex items-center gap-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> Uncheck only if you prefer to handle the support file manually</div></div></div>'),Ii=Ct('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>'),Ei=Ct('<svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>'),qi=Ct('<svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>'),Ni=v('<div class="mt-2"><div class="w-full bg-base-300 rounded-full h-2"><div class="bg-primary h-2 rounded-full transition-all duration-500"></div></div></div>'),zi=v('<div class="mt-4"><div><!> <span> </span></div> <!></div>'),ji=v('<span class="flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path></svg> <span> </span></span>'),Ri=v('<span class="loading loading-spinner loading-sm"></span>'),Ui=v(`<div class="space-y-4"><div class="card bg-base-200"><div class="card-body"><h3 class="card-title text-lg">Generate Support Report</h3> <div class="space-y-3 mb-4"><p class="text-sm text-base-content/80">Support reports are <strong>essential for troubleshooting</strong> and dramatically improve
              our ability to resolve issues you're experiencing. They provide developers with crucial
              context about your system configuration, recent application logs, and error patterns that
              would be impossible to diagnose otherwise.</p> <div class="alert alert-warning shadow-sm"><svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <div><h4 class="font-bold">Important: File a GitHub Issue</h4> <p class="text-sm">Please <a href="https://github.com/tphakala/birdnet-go/issues/new" target="_blank" class="link link-primary font-semibold">create a GitHub issue</a> describing your problem <strong>before or after</strong> generating this support report.
                  This allows for proper tracking and communication about your issue.</p></div></div> <div class="bg-base-100 rounded-lg p-3 border border-base-300"><h4 class="font-semibold text-sm mb-2">What's included in the report:</h4> <ul class="text-xs space-y-1 text-base-content/70"><li class="flex items-start gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-success mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <span><strong>Application logs</strong> - Recent errors and debug information</span></li> <li class="flex items-start gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-success mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <span><strong>Configuration</strong> - Your settings with sensitive data removed</span></li> <li class="flex items-start gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-success mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <span><strong>System information</strong> - OS version, memory, and runtime details</span></li> <li class="flex items-start gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-error mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <span><strong>NOT included</strong> - Audio files, bird detections, or personal data</span></li></ul></div></div> <div class="space-y-2"><!> <!> <!> <div class="form-control mt-4"><label class="label" for="userMessage"><span class="label-text">Describe the issue</span></label> <textarea id="userMessage" class="textarea textarea-bordered textarea-sm h-24 text-base-content" placeholder="Please describe the issue and include GitHub issue link if applicable (e.g., #123)" rows="4"></textarea> <div class="label"><span class="label-text-alt text-base-content/60">💡 Tip: If you have a GitHub issue, please include the issue number (e.g., #123)
                  and mention your System ID <span class="font-mono text-xs"> </span> in the
                  GitHub issue to help developers link your support data.</span></div></div> <!></div> <!> <div class="card-actions justify-end mt-6"><button><!></button></div></div></div> <div class="alert alert-info mt-4"><svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <div><h3 class="font-bold">Privacy & Data Protection</h3> <div class="text-sm mt-1"><p>Support reports are designed to protect your privacy:</p> <ul class="list-disc list-inside mt-2 space-y-1"><li>Passwords, API keys, and tokens are automatically removed</li> <li>No audio recordings or bird detection data is included</li> <li>Only application logs and scrubbed configuration are collected</li> <li>Data is encrypted in transit and at rest</li> <li>Uploaded data is retained for 90 days in Sentry's EU data center</li> <li>You can download the report locally before deciding to upload</li></ul> <p class="mt-2 text-xs">Learn more about <a href="https://docs.sentry.io/organization/data-storage-location/" target="_blank" class="link link-primary">Sentry's data storage</a> and <a href="https://sentry.io/security/" target="_blank" class="link link-primary">security practices</a>.</p></div></div></div></div>`),Oi=v('<div class="space-y-4"><!> <!></div>');function Fi(c,t){Ke(t,!0);const[d,N]=ft(),re=()=>$e(wa,"$supportSettings",d),se=()=>$e(Le,"$settingsStore",d);let s=p(()=>re()||{sentry:{enabled:!1,dsn:"",environment:"production",includePrivateInfo:!1},telemetry:{enabled:!0,includeSystemInfo:!0,includeAudioInfo:!1}}),i=p(se),g=p(()=>Fe(e(i).originalData?.support?.sentry,e(i).formData?.support?.sentry)),ie=be(!1),oe=be(""),Y=be("info"),P=be(0),S=tt({includeLogs:!0,includeConfig:!0,includeSystemInfo:!0,userMessage:"",uploadToSentry:!0}),L=be("");yt(()=>{fetch("/api/v2/settings/systemid").then(I=>I.json()).then(I=>{m(L,I.systemID||"",!0)}).catch(I=>{console.error("Failed to fetch system ID:",I),m(L,"Error loading system ID")})});function E(I){O.updateSection("support",{sentry:{...e(s).sentry,enabled:I}})}function T(I,K,J){m(oe,I,!0),m(Y,K,!0),m(P,J,!0),K==="info"&&J<90&&setTimeout(()=>{e(ie)&&e(P)<90&&m(P,Math.min(e(P)+10,90),!0)},1e3)}var M=Oi(),G=a(M);Re(G,{title:"Error Tracking & Telemetry",description:"Optional error tracking to help improve BirdNET-Go reliability and performance",defaultOpen:!0,get hasChanges(){return e(g)},children:(I,K)=>{var J=Pi(),k=r(a(J),2);const b=p(()=>e(i).isLoading||e(i).isSaving);Ee(k,{label:"Enable Error Tracking (Opt-in)",get disabled(){return e(b)},onchange:()=>E(e(s).sentry.enabled),get checked(){return e(s).sentry.enabled},set checked(ae){e(s).sentry.enabled=ae}});var V=r(k,2),A=r(a(V),2),ne=a(A),w=r(ne,2);w.__click=[Ai,L];var U=r(V,2);{var Z=ae=>{var ue=Di();n(ae,ue)};h(U,ae=>{e(s).sentry.enabled&&ae(Z)})}q(()=>Yt(ne,e(L))),n(I,J)},$$slots:{default:!0}});var z=r(G,2);Re(z,{title:"Support & Diagnostics",description:"Help developers fix your issues faster by providing essential diagnostic information",defaultOpen:!1,children:(I,K)=>{var J=Ui(),k=a(J),b=a(k),V=r(a(b),4),A=a(V);Ee(A,{label:"Include recent logs",get disabled(){return e(ie)},get checked(){return S.includeLogs},set checked(B){S.includeLogs=B}});var ne=r(A,2);Ee(ne,{label:"Include configuration (sensitive data removed)",get disabled(){return e(ie)},get checked(){return S.includeConfig},set checked(B){S.includeConfig=B}});var w=r(ne,2);Ee(w,{label:"Include system information",get disabled(){return e(ie)},get checked(){return S.includeSystemInfo},set checked(B){S.includeSystemInfo=B}});var U=r(w,2),Z=r(a(U),2),ae=r(Z,2),ue=a(ae),me=r(a(ue)),u=a(me),_=r(U,2);{var x=B=>{var H=Bi(),$=a(H);Ee($,{label:"Upload to developers (recommended)",get disabled(){return e(ie)},get checked(){return S.uploadToSentry},set checked(o){S.uploadToSentry=o}}),n(B,H)};h(_,B=>{e(s).sentry.enabled&&B(x)})}var y=r(V,2);{var D=B=>{var H=zi(),$=a(H);let o;var l=a($);{var f=ge=>{var Q=Ii();n(ge,Q)},C=(ge,Q)=>{{var de=fe=>{var ye=Ei();n(fe,ye)},xe=(fe,ye)=>{{var Se=he=>{var Be=qi();n(he,Be)};h(fe,he=>{e(Y)==="error"&&he(Se)},ye)}};h(ge,fe=>{e(Y)==="success"?fe(de):fe(xe,!1)},Q)}};h(l,ge=>{e(Y)==="info"?ge(f):ge(C,!1)})}var R=r(l,2),W=a(R),we=r($,2);{var ke=ge=>{var Q=Ni(),de=a(Q),xe=a(de);let fe;q(ye=>fe=St(xe,"",fe,ye),[()=>({width:`${e(P)??""}%`})]),n(ge,Q)};h(we,ge=>{e(ie)&&e(P)>0&&ge(ke)})}q(ge=>{o=Pe($,1,"alert",null,o,ge),ee(W,e(oe))},[()=>({"alert-info":e(Y)==="info","alert-success":e(Y)==="success","alert-error":e(Y)==="error"})]),n(B,H)};h(y,B=>{e(oe)&&B(D)})}var X=r(y,2),ce=a(X);ce.__click=[Mi,ie,oe,Y,P,T,S];let j;var F=a(ce);{var pe=B=>{var H=ji(),$=r(a(H),2),o=a($);q(()=>ee(o,S.uploadToSentry?"Generate & Upload":"Generate & Download")),n(B,H)},le=B=>{var H=Ri();n(B,H)};h(F,B=>{e(ie)?B(le,!1):B(pe)})}q(B=>{Z.disabled=e(ie),ee(u,e(L)),ce.disabled=e(ie)||!S.includeLogs&&!S.includeConfig&&!S.includeSystemInfo,j=Pe(ce,1,"btn btn-primary",null,j,B)},[()=>({"btn-disabled":e(ie)||!S.includeLogs&&!S.includeConfig&&!S.includeSystemInfo})]),Tt(Z,()=>S.userMessage,B=>S.userMessage=B),n(I,J)},$$slots:{default:!0}}),n(c,M),Je(),N()}at(["click"]);function Hi(c,t,d,N,re){const se=e(t).trim();if(!se||e(d).config[se])return;const s=Number(e(N));if(s<0||s>1)return;const i=Number(e(re))||0,g={threshold:s,interval:i,actions:[]};O.updateSection("species",{config:{...e(d).config,[se]:g}}),m(t,""),m(N,.5),m(re,0)}function Qi(c,t,d,N,re){if(!e(t))return;const se={type:e(d).type,command:e(d).command,parameters:e(d).parameters.split(",").map(i=>i.trim()).filter(i=>i),executeDefaults:e(d).executeDefaults},s={...e(N).config,[e(t)]:{...e(N).config[e(t)],actions:[se]}};O.updateSection("species",{config:s}),re()}function Gi(c,t){e(t).parameters=""}var Vi=(c,t,d)=>t(e(d)),Wi=v('<div class="flex items-center justify-between p-2 rounded-md bg-base-200"><span class="text-sm"> </span> <button type="button" class="btn btn-ghost btn-xs">✕</button></div>'),Ki=v('<div class="text-sm text-base-content/60 italic p-2 text-center">No species added to include list</div>'),Ji=v('<div class="space-y-4"><div class="space-y-2"><!> <!></div> <!></div>'),Yi=(c,t,d)=>t(e(d)),Zi=v('<div class="flex items-center justify-between p-2 rounded-md bg-base-200"><span class="text-sm"> </span> <button type="button" class="btn btn-ghost btn-xs">✕</button></div>'),Xi=v('<div class="text-sm text-base-content/60 italic p-2 text-center">No species added to exclude list</div>'),$i=v('<div class="space-y-4"><div class="space-y-2"><!> <!></div> <!></div>'),en=v('<div class="grid grid-cols-12 gap-2 mb-1 text-xs font-medium text-base-content/70"><div class="col-span-5 px-2">Species</div> <div class="col-span-6 px-2">Settings</div> <div class="col-span-1 px-2 text-right">Actions</div></div>'),tn=v('<div class="flex items-center justify-between p-2 rounded-md bg-base-300"><div class="flex-grow grid grid-cols-12 gap-2"><div class="col-span-6"><!></div> <div class="col-span-2"><!></div> <div class="col-span-2"><!></div> <div class="col-span-2 flex space-x-1"><button type="button" class="btn btn-primary btn-xs flex-1">Save</button> <button type="button" class="btn btn-ghost btn-xs flex-1">Cancel</button></div></div></div>'),an=v('<span class="badge badge-sm badge-secondary"> </span>'),sn=v('<span class="badge badge-sm badge-accent">Custom Action</span>'),rn=v('<span class="badge badge-sm badge-info">+Defaults</span>'),nn=(c,t,d)=>t(d()),on=(c,t,d)=>t(d()),ln=(c,t,d)=>t(d()),dn=v('<div class="flex items-center justify-between p-2 rounded-md bg-base-200"><div class="flex-grow grid grid-cols-12 gap-2 items-center"><div class="col-span-5 text-sm pl-2"> </div> <div class="col-span-6 flex flex-wrap gap-1"><span class="badge badge-sm badge-neutral"> </span> <!> <!> <!></div> <div class="col-span-1 text-right"><div class="dropdown dropdown-end"><div tabindex="0" role="button" class="btn btn-ghost btn-xs">⋮</div> <ul class="dropdown-content menu bg-base-100 rounded-box z-[1] w-40 p-2 shadow"><li><button>Edit Config</button></li> <li><button>Add Action</button></li> <li><button class="text-error">Remove</button></li></ul></div></div></div></div>'),cn=v('<div class="text-sm text-base-content/60 italic p-2 text-center">No custom species configurations added</div>'),vn=v(`<div class="space-y-4"><div class="text-sm text-base-content mb-4"><p>Configure species-specific settings:</p> <ul class="list-disc list-inside pl-4 text-xs"><li><b>Threshold</b>: Minimum confidence score (0-1) required for detection</li> <li><b>Interval</b>: Minimum time in seconds between detections of the same species (0 = use
          global default)</li> <li><b>Actions</b>: Custom commands to execute when this species is detected</li></ul></div> <div class="space-y-2"><!> <!> <!> <!></div> <div class="mt-4 space-y-4"><div class="grid grid-cols-12 gap-4"><div class="col-span-6"><!></div> <div class="col-span-2"><!></div> <div class="col-span-2"><!></div> <div class="col-span-2"><button type="button" class="btn btn-primary btn-sm w-full">Add</button></div></div></div></div>`),un=(c,t)=>t("CommonName"),pn=(c,t)=>t("ScientificName"),gn=(c,t)=>t("Confidence"),hn=(c,t)=>t("Time"),bn=(c,t)=>t("Source"),mn=(c,t)=>c.key==="Escape"?t():null,fn=v('<div class="modal modal-open"><div class="modal-box bg-base-100 max-h-[90vh] overflow-y-auto"><h3 class="text-lg font-bold mb-4"> </h3> <div class="space-y-4"><!> <!> <div class="form-control"><label class="label" for="action-parameters"><span class="label-text">Parameters</span></label> <!></div> <div><div class="font-medium text-sm mb-2">Available Parameters</div> <div class="flex flex-wrap gap-2"><button type="button" class="btn btn-xs">CommonName</button> <button type="button" class="btn btn-xs">ScientificName</button> <button type="button" class="btn btn-xs">Confidence</button> <button type="button" class="btn btn-xs">Time</button> <button type="button" class="btn btn-xs">Source</button></div> <div class="mt-2"><button type="button" class="btn btn-xs btn-warning">Clear Parameters</button></div></div> <!></div> <div class="modal-action mt-6"><button type="button" class="btn btn-primary">Save</button> <button type="button" class="btn btn-ghost">Cancel</button></div></div> <div class="modal-backdrop bg-black/50" role="button" tabindex="0" aria-label="Close actions modal"></div></div>'),_n=v("<!> <!> <!> <!>",1);function xn(c,t){Ke(t,!0);const[d,N]=ft(),re=()=>$e(xa,"$speciesSettings",d),se=()=>$e(Le,"$settingsStore",d);let s=p(()=>re()||{include:{enabled:!1,species:[]},exclude:{enabled:!1,species:[]},config:{}}),i=p(se),g=be(tt([])),ie=be(tt([])),oe=be(tt([])),Y=be(tt([])),P=be(tt([])),S=be(""),L=be(""),E=be(""),T=be(.5),M=be(0),G=be(null),z=be(""),I=be(.5),K=be(0),J=be(!1),k=be(""),b=be(tt({type:"ExecuteCommand",command:"",parameters:"",executeDefaults:!0})),V=p(()=>Fe(e(i).originalData?.species?.include,e(i).formData?.species?.include)),A=p(()=>Fe(e(i).originalData?.species?.exclude,e(i).formData?.species?.exclude)),ne=p(()=>Fe(e(i).originalData?.species?.config,e(i).formData?.species?.config));async function w(){try{const l=await fetch("/api/v2/range/species/list");if(l.ok){const f=await l.json();m(g,f.species?.map(C=>C.commonName||C.label)||[],!0),m(ie,[...e(g)],!0)}}catch(l){console.error("Failed to load species data:",l),m(g,[],!0),m(ie,[],!0)}}yt(()=>{w()});function U(l){if(!l||l.length<2){m(oe,[],!0);return}const f=l.toLowerCase();m(oe,e(g).filter(C=>C.toLowerCase().includes(f)&&!e(s).include.species.includes(C)).slice(0,10),!0)}function Z(l){if(!l||l.length<2){m(Y,[],!0);return}const f=l.toLowerCase();m(Y,e(ie).filter(C=>C.toLowerCase().includes(f)&&!e(s).exclude.species.includes(C)).slice(0,10),!0)}function ae(l){if(!l||l.length<2){m(P,[],!0);return}const f=l.toLowerCase(),C=Object.keys(e(s).config).map(R=>R.toLowerCase());m(P,e(g).filter(R=>{const W=R.toLowerCase();return W.includes(f)&&!C.includes(W)}).slice(0,10),!0)}function ue(l){if(!l.trim()||e(s).include.species.includes(l))return;const f=[...e(s).include.species,l];O.updateSection("species",{include:{...e(s).include,species:f}})}function me(l){const f=e(s).include.species.filter(C=>C!==l);O.updateSection("species",{include:{...e(s).include,species:f}})}function u(l){if(!l.trim()||e(s).exclude.species.includes(l))return;const f=[...e(s).exclude.species,l];O.updateSection("species",{exclude:{...e(s).exclude,species:f}})}function _(l){const f=e(s).exclude.species.filter(C=>C!==l);O.updateSection("species",{exclude:{...e(s).exclude,species:f}})}function x(l){const{[l]:f,...C}=e(s).config;O.updateSection("species",{config:C})}function y(l){m(G,l,!0),m(z,l,!0),m(I,e(s).config[l].threshold,!0),m(K,e(s).config[l].interval||0,!0)}function D(){if(!e(G)||!e(z))return;const l=e(G),f=e(z),C=e(I),R=e(K)||0,W={...e(s).config};l!==f?(W[f]={threshold:C,interval:R,actions:e(s).config[l].actions||[]},delete W[l]):W[l]={...W[l],threshold:C,interval:R},O.updateSection("species",{config:W}),X()}function X(){m(G,null),m(z,""),m(I,.5),m(K,0)}function ce(l){m(k,l,!0);const f=e(s).config[l]?.actions?.[0];f?m(b,{type:f.type,command:f.command,parameters:Array.isArray(f.parameters)?f.parameters.join(","):"",executeDefaults:f.executeDefaults!==!1},!0):m(b,{type:"ExecuteCommand",command:"",parameters:"",executeDefaults:!0},!0),m(J,!0)}function j(){m(J,!1),m(k,"")}function F(l){e(b).parameters?e(b).parameters+=","+l:e(b).parameters=l}var pe=_n(),le=ze(pe);Re(le,{title:"Always Include Species",description:"Species in this list will always be included in range of detected species",defaultOpen:!0,get hasChanges(){return e(V)},children:(l,f)=>{var C=Ji(),R=a(C),W=a(R);it(W,17,()=>e(s).include.species,nt,(de,xe)=>{var fe=Wi(),ye=a(fe),Se=a(ye),he=r(ye,2);he.__click=[Vi,me,xe],q(()=>{ee(Se,e(xe)),he.disabled=e(i).isLoading||e(i).isSaving,Me(he,"aria-label",`Remove ${e(xe)??""}`)}),n(de,fe)});var we=r(W,2);{var ke=de=>{var xe=Ki();n(de,xe)};h(we,de=>{e(s).include.species.length===0&&de(ke)})}var ge=r(R,2);const Q=p(()=>e(i).isLoading||e(i).isSaving);Rt(ge,{label:"Add New Species to Include",placeholder:"Add species to include",get predictions(){return e(oe)},size:"sm",onInput:U,onAdd:ue,get disabled(){return e(Q)},get value(){return e(S)},set value(de){m(S,de,!0)}}),n(l,C)},$$slots:{default:!0}});var B=r(le,2);Re(B,{title:"Always Exclude Species",description:"Species in this list will always be excluded from detection",defaultOpen:!0,get hasChanges(){return e(A)},children:(l,f)=>{var C=$i(),R=a(C),W=a(R);it(W,17,()=>e(s).exclude.species,nt,(de,xe)=>{var fe=Zi(),ye=a(fe),Se=a(ye),he=r(ye,2);he.__click=[Yi,_,xe],q(()=>{ee(Se,e(xe)),he.disabled=e(i).isLoading||e(i).isSaving,Me(he,"aria-label",`Remove ${e(xe)??""}`)}),n(de,fe)});var we=r(W,2);{var ke=de=>{var xe=Xi();n(de,xe)};h(we,de=>{e(s).exclude.species.length===0&&de(ke)})}var ge=r(R,2);const Q=p(()=>e(i).isLoading||e(i).isSaving);Rt(ge,{label:"Add New Species to Exclude",placeholder:"Add species to exclude",get predictions(){return e(Y)},size:"sm",onInput:Z,onAdd:u,get disabled(){return e(Q)},get value(){return e(L)},set value(de){m(L,de,!0)}}),n(l,C)},$$slots:{default:!0}});var H=r(B,2);Re(H,{title:"Custom Species Configuration",description:"Species specific threshold values, detection intervals, and actions",defaultOpen:!0,get hasChanges(){return e(ne)},children:(l,f)=>{var C=vn(),R=r(a(C),2),W=a(R);{var we=Ce=>{var _e=en();n(Ce,_e)};h(W,Ce=>{Object.keys(e(s).config).length>0&&Ce(we)})}var ke=r(W,2);{var ge=Ce=>{var _e=tn(),Ie=a(_e),et=a(Ie),qe=a(et);Ve(qe,{placeholder:"Species name",size:"xs",get value(){return e(z)},set value(dt){m(z,dt,!0)}});var Ue=r(et,2),st=a(Ue);Qe(st,{label:"Threshold",get value(){return e(I)},onUpdate:dt=>m(I,dt,!0),min:0,max:1,step:.01,placeholder:"0.5"});var ct=r(Ue,2),Ye=a(ct);Qe(Ye,{label:"Interval",get value(){return e(K)},onUpdate:dt=>m(K,dt,!0),min:0,max:3600,step:1,placeholder:"0"});var Ze=r(ct,2),lt=a(Ze);lt.__click=D;var gt=r(lt,2);gt.__click=X,n(Ce,_e)};h(ke,Ce=>{e(G)&&Ce(ge)})}var Q=r(ke,2);it(Q,17,()=>Object.entries(e(s).config),nt,(Ce,_e)=>{var Ie=p(()=>ca(e(_e),2));let et=()=>e(Ie)[0],qe=()=>e(Ie)[1];var Ue=bt(),st=ze(Ue);{var ct=Ye=>{var Ze=dn(),lt=a(Ze),gt=a(lt),dt=a(gt),xt=r(gt,2),wt=a(xt),Lt=a(wt),kt=r(wt,2);{var Et=Ne=>{var vt=an(),Pt=a(vt);q(()=>ee(Pt,`Interval: ${qe().interval??""}s`)),n(Ne,vt)};h(kt,Ne=>{qe().interval>0&&Ne(Et)})}var At=r(kt,2);{var Mt=Ne=>{var vt=sn();n(Ne,vt)};h(At,Ne=>{qe().actions?.length>0&&Ne(Mt)})}var qt=r(At,2);{var Ot=Ne=>{var vt=rn();n(Ne,vt)};h(qt,Ne=>{qe().actions?.[0]?.executeDefaults&&Ne(Ot)})}var Ft=r(xt,2),Ht=a(Ft),Dt=r(a(Ht),2),Nt=a(Dt),Qt=a(Nt);Qt.__click=[nn,y,et];var zt=r(Nt,2),Gt=a(zt);Gt.__click=[on,ce,et];var Vt=r(zt,2),ve=a(Vt);ve.__click=[ln,x,et],q(Ne=>{ee(dt,et()),ee(Lt,`Threshold: ${Ne??""}`)},[()=>qe().threshold.toFixed(2)]),n(Ye,Ze)};h(st,Ye=>{e(G)!==et()&&Ye(ct)})}n(Ce,Ue)});var de=r(Q,2);{var xe=Ce=>{var _e=cn();n(Ce,_e)};h(de,Ce=>{Object.keys(e(s).config).length===0&&Ce(xe)})}var fe=r(R,2),ye=a(fe),Se=a(ye),he=a(Se);const Be=p(()=>e(i).isLoading||e(i).isSaving);Rt(he,{placeholder:"Species name",get predictions(){return e(P)},size:"sm",onInput:ae,onAdd:()=>{},buttonText:"",buttonIcon:!1,get disabled(){return e(Be)},get value(){return e(E)},set value(Ce){m(E,Ce,!0)}});var je=r(Se,2),Te=a(je);Qe(Te,{label:"Threshold",get value(){return e(T)},onUpdate:Ce=>m(T,Ce,!0),min:0,max:1,step:.01,placeholder:"0.5"});var He=r(je,2),We=a(He);Qe(We,{label:"Interval (sec)",get value(){return e(M)},onUpdate:Ce=>m(M,Ce,!0),min:0,max:3600,step:1,placeholder:"0"});var De=r(He,2),ot=a(De);ot.__click=[Hi,E,s,T,M],q(Ce=>ot.disabled=Ce,[()=>!e(E).trim()||e(T)<0||e(T)>1]),n(l,C)},$$slots:{default:!0}});var $=r(H,2);{var o=l=>{var f=fn(),C=a(f),R=a(C),W=a(R),we=r(R,2),ke=a(we);pt(ke,{label:"Action Type",options:[{value:"ExecuteCommand",label:"Execute Command"}],disabled:!0,helpText:"Currently, only Execute Command actions are supported",get value(){return e(b).type},set value(Ie){e(b).type=Ie}});var ge=r(ke,2);Ve(ge,{label:"Command",placeholder:"/path/to/your/command",helpText:"Provide the full path to the command or script you want to execute",get value(){return e(b).command},set value(Ie){e(b).command=Ie}});var Q=r(ge,2),de=r(a(Q),2);Ve(de,{id:"action-parameters",placeholder:"Parameters will appear here",readonly:!0,helpText:"These values will be passed to your command in the order listed",get value(){return e(b).parameters},set value(Ie){e(b).parameters=Ie}});var xe=r(Q,2),fe=r(a(xe),2),ye=a(fe);ye.__click=[un,F];var Se=r(ye,2);Se.__click=[pn,F];var he=r(Se,2);he.__click=[gn,F];var Be=r(he,2);Be.__click=[hn,F];var je=r(Be,2);je.__click=[bn,F];var Te=r(fe,2),He=a(Te);He.__click=[Gi,b];var We=r(xe,2);Ee(We,{label:"Also run default actions (database storage, notifications, etc.)",helpText:"When enabled, both your custom action and the system's default actions will run. When disabled, only your custom action will execute.",get checked(){return e(b).executeDefaults},set checked(Ie){e(b).executeDefaults=Ie}});var De=r(we,2),ot=a(De);ot.__click=[Qi,k,b,s,j];var Ce=r(ot,2);Ce.__click=j;var _e=r(C,2);_e.__click=j,_e.__keydown=[mn,j],q(()=>ee(W,`Actions for ${e(k)??""}`)),n(l,f)};h($,l=>{e(J)&&l(o)})}n(c,pe),Je(),N()}at(["click","keydown"]);async function wn(){try{await O.saveSettings()}catch(c){console.error("Failed to save settings:",c)}}function yn(){O.resetAllSettings()}var kn=v('<button type="button" class="btn btn-ghost btn-sm" aria-label="Reset all changes"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> Reset</button>'),Sn=v("<!> Saving...",1),Tn=v('<div class="flex justify-end items-center gap-3 mt-6 pt-6"><!> <button type="button" class="btn btn-primary"><!></button></div>');function Cn(c,t){Ke(t,!0);const[d,N]=ft(),re=()=>$e(Le,"$settingsStore",d),se=()=>$e(pa,"$hasUnsavedChanges",d);let s=p(re),i=p(se);var g=Tn(),ie=a(g);{var oe=E=>{var T=kn();T.__click=[yn],q(()=>T.disabled=e(s).isSaving),n(E,T)};h(ie,E=>{e(i)&&E(oe)})}var Y=r(ie,2);Y.__click=[wn];var P=a(Y);{var S=E=>{var T=Sn(),M=ze(T);ta(M,{size:"sm"}),n(E,T)},L=E=>{var T=Xe("Save Changes");n(E,T)};h(P,E=>{e(s).isSaving?E(S):E(L,!1)})}q(()=>{Y.disabled=!e(i)||e(s).isSaving,Me(Y,"aria-busy",e(s).isSaving),Me(Y,"aria-label",e(s).isSaving?"Saving changes...":"Save Changes")}),n(c,g),Je(),N()}at(["click"]);function Ln(c,t,d){m(t,!1),d()()}var An=v('<button type="button" class="btn btn-sm btn-ghost" aria-label="Dismiss alert"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>'),Mn=v('<div><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 shrink-0 stroke-current" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path></svg> <span><!></span> <!></div>');function Dn(c,t){Ke(t,!0);let d=te(t,"message",3,""),N=te(t,"type",3,"error"),re=te(t,"dismissible",3,!1),se=te(t,"onDismiss",3,()=>{}),s=te(t,"className",3,""),i=mt(t,["$$slots","$$events","$$legacy","message","type","dismissible","onDismiss","className","children"]),g=be(!0);const ie={error:"alert-error",warning:"alert-warning",info:"alert-info",success:"alert-success"},oe={error:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z",warning:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z",info:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z",success:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"};var Y=bt(),P=ze(Y);{var S=L=>{var E=Mn();_t(E,b=>({class:b,role:"alert",...i}),[()=>Ae("alert",ie[N()],s())]);var T=a(E),M=a(T),G=r(T,2),z=a(G);{var I=b=>{var V=bt(),A=ze(V);It(A,()=>t.children),n(b,V)},K=b=>{var V=Xe();q(()=>ee(V,d())),n(b,V)};h(z,b=>{t.children?b(I):b(K,!1)})}var J=r(G,2);{var k=b=>{var V=An();V.__click=[Ln,g,se],n(b,V)};h(J,b=>{re()&&b(k)})}q(()=>Me(M,"d",oe[N()])),n(L,E)};h(P,L=>{e(g)&&L(S)})}n(c,Y),Je()}at(["click"]);var Pn=v('<div class="mb-6"><!></div>'),Bn=v('<div class="flex justify-center items-center py-12"><!> <span class="ml-3 text-lg">Loading settings...</span></div>'),In=v('<div class="card bg-base-100 shadow-sm p-6"><div class="text-center py-12 text-base-content/70"><h2 class="text-xl font-semibold mb-2">Settings Not Found</h2> <p> </p></div></div>'),En=v('<div class="space-y-6"><!></div> <div class="mt-8"><!></div>',1),qn=v('<main class="col-span-12 container mx-auto"><!> <!></main>');function On(c,t){Ke(t,!0);const[d,N]=ft(),re=()=>$e(Le,"$settingsStore",d);function se(){const E=window.location.pathname.split("/"),T=E[E.length-1];return{main:"node",audio:"audio",detectionfilters:"filters",integrations:"integration",security:"security",species:"species",support:"support"}[T]||"node"}let s=be(tt(se())),i=p(re);Kt(()=>{O.loadSettings()}),Kt(()=>{const L=()=>{m(s,se(),!0)};window.addEventListener("popstate",L);const E=T=>{const G=T.target.closest("a");G&&G.href.includes("/settings/")&&setTimeout(L,0)};return document.addEventListener("click",E),()=>{window.removeEventListener("popstate",L),document.removeEventListener("click",E)}});var g=qn();$t(L=>{va.title="Settings - BirdNET-Go"});var ie=a(g);{var oe=L=>{var E=Pn(),T=a(E);Dn(T,{get message(){return e(i).error},onDismiss:()=>O.clearError()}),n(L,E)};h(ie,L=>{e(i).error&&L(oe)})}var Y=r(ie,2);{var P=L=>{var E=Bn(),T=a(E);ta(T,{size:"lg"}),n(L,E)},S=L=>{var E=En(),T=ze(E),M=a(T);{var G=J=>{Bs(J,{})},z=(J,k)=>{{var b=A=>{Ws(A,{})},V=(A,ne)=>{{var w=Z=>{mr(Z,{})},U=(Z,ae)=>{{var ue=u=>{ri(u,{})},me=(u,_)=>{{var x=D=>{Li(D,{})},y=(D,X)=>{{var ce=F=>{xn(F,{})},j=(F,pe)=>{{var le=H=>{Fi(H,{})},B=H=>{var $=In(),o=a($),l=r(a(o),2),f=a(l);q(()=>ee(f,`The requested settings section "${e(s)??""}" could not be found.`)),n(H,$)};h(F,H=>{e(s)==="support"?H(le):H(B,!1)},pe)}};h(D,F=>{e(s)==="species"?F(ce):F(j,!1)},X)}};h(u,D=>{e(s)==="security"?D(x):D(y,!1)},_)}};h(Z,u=>{e(s)==="integration"?u(ue):u(me,!1)},ae)}};h(A,Z=>{e(s)==="filters"?Z(w):Z(U,!1)},ne)}};h(J,A=>{e(s)==="audio"?A(b):A(V,!1)},k)}};h(M,J=>{e(s)==="node"?J(G):J(z,!1)})}var I=r(T,2),K=a(I);Cn(K,{}),n(L,E)};h(Y,L=>{e(i).isLoading?L(P):L(S,!1)})}n(c,g),Je(),N()}export{On as default};
