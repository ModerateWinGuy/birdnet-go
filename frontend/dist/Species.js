import{c as ot}from"./index.js";import{p as ue,a as ve,k as g,o as n,l as s,C as lt,i as k,P as ct,t as O,B as x,x as me,h as b,j as _e,f as dt,d as Ee,q as He,r as U,w as se,s as ee,b as ce,z as vt,g as a,n as T,e as re,y as Ae,E as Me,v as ut}from"./vendor.js";import{S as Pe,I as de,a as je}from"./Input.js";import{F as te}from"./FormField.js";function mt(L,i){i.onReset()}function _t(L,i){i.onExport()}var ft=g("<!> <!>",1),ht=g("<span>(filtered)</span>"),bt=g('<span class="loading loading-spinner loading-sm"></span>'),gt=g('<div class="card bg-base-100 shadow-sm"><div class="card-body card-padding"><h2 class="card-title" id="species-filters-heading">Filter Data</h2> <form id="speciesFiltersForm" class="space-y-4"><div class="filters-grid"><!> <!> <!> <!></div> <div class="flex justify-between items-center"><div class="text-sm text-base-content/60"><span> </span> species <!></div> <div class="flex gap-2"><button type="button" class="btn btn-ghost">Reset</button> <button type="button" class="btn btn-secondary"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg> Export CSV</button> <button type="submit" class="btn btn-primary"><!> Apply Filters</button></div></div></form></div></div>');function pt(L,i){ue(i,!0);let o=ve(i,"filters",15),m=ve(i,"isLoading",3,!1);const y=[{value:"all",label:"All Time"},{value:"today",label:"Today"},{value:"week",label:"Last 7 Days"},{value:"month",label:"Last 30 Days"},{value:"90days",label:"Last 90 Days"},{value:"year",label:"Last 12 Months"},{value:"custom",label:"Custom Range"}],D=[{value:"count_desc",label:"Most Detections"},{value:"count_asc",label:"Fewest Detections"},{value:"name_asc",label:"Name (A-Z)"},{value:"name_desc",label:"Name (Z-A)"},{value:"first_seen_desc",label:"Recently First Seen"},{value:"first_seen_asc",label:"Earliest First Seen"},{value:"last_seen_desc",label:"Recently Last Seen"},{value:"confidence_desc",label:"Highest Confidence"}];function d(c){c.preventDefault(),i.onSubmit()}var _=gt(),$=s(_),E=n(s($),2),F=s(E);lt(F,"",{},{display:"grid","grid-template-columns":"repeat(auto-fit, minmax(250px, 1fr))",gap:"1rem"});var M=s(F);te(M,{label:"Time Period",id:"timePeriod",children:(c,w)=>{Pe(c,{id:"timePeriod",get options(){return y},get value(){return o().timePeriod},set value(S){o(o().timePeriod=S,!0)}})},$$slots:{default:!0}});var z=n(M,2);{var q=c=>{var w=ft(),S=dt(w);te(S,{label:"From",id:"startDate",children:(K,ae)=>{de(K,{type:"date",id:"startDate",get value(){return o().startDate},set value(Q){o(o().startDate=Q,!0)}})},$$slots:{default:!0}});var ne=n(S,2);te(ne,{label:"To",id:"endDate",children:(K,ae)=>{de(K,{type:"date",id:"endDate",get value(){return o().endDate},set value(Q){o(o().endDate=Q,!0)}})},$$slots:{default:!0}}),b(c,w)};k(z,c=>{o().timePeriod==="custom"&&c(q)})}var H=n(z,2);te(H,{label:"Sort By",id:"sortOrder",children:(c,w)=>{Pe(c,{id:"sortOrder",get options(){return D},get value(){return o().sortOrder},set value(S){o(o().sortOrder=S,!0)}})},$$slots:{default:!0}});var N=n(H,2);te(N,{label:"Search Species",id:"searchTerm",children:(c,w)=>{de(c,ct({type:"text",id:"searchTerm",placeholder:"Search by name..."},()=>({oninput:i.onSearchInput}),{get value(){return o().searchTerm},set value(S){o(o().searchTerm=S,!0)}}))},$$slots:{default:!0}});var Z=n(F,2),A=s(Z),R=s(A),W=s(R),B=n(R,2);{var I=c=>{var w=ht();b(c,w)};k(B,c=>{o().searchTerm&&c(I)})}var G=n(A,2),P=s(G);P.__click=[mt,i];var j=n(P,2);j.__click=[_t,i];var l=n(j,2),v=s(l);{var J=c=>{var w=bt();b(c,w)};k(v,c=>{m()&&c(J)})}O(()=>{x(W,i.filteredCount),P.disabled=m(),j.disabled=m(),l.disabled=m()}),me("submit",E,d),b(L,_),_e()}Ee(["click"]);var wt=g('<img class="rounded-xl h-40 w-full object-cover"/>'),xt=g('<div class="rounded-xl h-40 w-full bg-base-300"></div>'),yt=g('<div class="flex justify-between"><span class="text-base-content/60">First:</span> <span class="text-xs"> </span></div>'),Dt=g('<div><figure class="px-4 pt-4"><!></figure> <div class="card-body p-4"><h3 class="card-title text-base"> </h3> <p class="text-sm text-base-content/60 italic"> </p> <div class="text-sm space-y-1 mt-2"><div class="flex justify-between"><span class="text-base-content/60">Detections:</span> <span class="font-semibold"> </span></div> <div class="flex justify-between"><span class="text-base-content/60">Confidence:</span> <span class="font-semibold"> </span></div> <!></div></div></div>');function St(L,i){ue(i,!0);let o=ve(i,"className",3,"");function m(l){return(l*100).toFixed(1)+"%"}function y(l){return l?new Date(l).toLocaleDateString():""}function D(l){const v=l.target;v.style.display="none",v.parentElement&&(v.parentElement.innerHTML='<div class="rounded-xl h-40 w-full bg-base-300"></div>')}var d=Dt(),_=s(d),$=s(_);{var E=l=>{var v=wt();O(()=>{se(v,"src",i.species.thumbnail_url),se(v,"alt",i.species.common_name)}),me("error",v,D),b(l,v)},F=l=>{var v=xt();b(l,v)};k($,l=>{i.species.thumbnail_url?l(E):l(F,!1)})}var M=n(_,2),z=s(M),q=s(z),H=n(z,2),N=s(H),Z=n(H,2),A=s(Z),R=n(s(A),2),W=s(R),B=n(A,2),I=n(s(B),2),G=s(I),P=n(B,2);{var j=l=>{var v=yt(),J=n(s(v),2),c=s(J);O(w=>x(c,w),[()=>y(i.species.first_heard)]),b(l,v)};k(P,l=>{i.species.first_heard&&l(j)})}O((l,v)=>{U(d,1,l),x(q,i.species.common_name),x(N,i.species.scientific_name),x(W,i.species.count),x(G,v)},[()=>He(ot("card bg-base-200",o())),()=>m(i.species.avg_confidence)]),b(L,d),_e()}var Ct=Ae('<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-primary" viewBox="0 0 20 20" fill="currentColor"><path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM13 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2h-2z"></path></svg>'),Tt=Ae('<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-secondary" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z" clip-rule="evenodd"></path></svg>'),kt=(L,i)=>T(i,"grid"),Lt=(L,i)=>T(i,"list"),zt=g('<div class="flex justify-center items-center p-8"><span class="loading loading-spinner loading-lg text-primary"></span></div>'),Ft=g('<div class="species-grid svelte-10viwev"></div>'),Mt=g("<img/>"),Pt=g('<tr><td><div class="flex items-center gap-3"><div class="avatar"><div><!></div></div> <div><div class="font-bold"> </div> <div class="text-sm opacity-50 italic"> </div></div></div></td><td class="font-semibold"> </td><td><div class="flex items-center gap-2"><progress max="1"></progress> <span class="text-sm"> </span></div></td><td> </td><td class="text-sm"> </td><td class="text-sm"> </td></tr>'),jt=g('<div class="overflow-x-auto"><table class="table w-full"><thead><tr><th>Species</th><th>Detections</th><th>Avg Confidence</th><th>Max Confidence</th><th>First Detected</th><th>Last Detected</th></tr></thead><tbody></tbody></table></div>'),Et=g('<div class="text-center py-8 text-base-content/50"><svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto mb-4 opacity-20" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5 3a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2V5a2 2 0 00-2-2H5zm9 4a1 1 0 10-2 0v6a1 1 0 102 0V7zm-3 2a1 1 0 10-2 0v4a1 1 0 102 0V9zm-3 3a1 1 0 10-2 0v1a1 1 0 102 0v-1z" clip-rule="evenodd"></path></svg> <p>No species found matching your filters.</p></div>'),Ht=g('<div class="col-span-12 space-y-4" role="region" aria-label="Species"><div class="card bg-base-100 shadow-sm"><div class="card-body card-padding svelte-10viwev"><div class="flex justify-between items-start"><div><h1 class="card-title text-2xl">Species</h1> <p class="text-base-content/60">Comprehensive list of all bird species that have been detected</p></div> <div class="flex gap-4"><!> <!></div></div></div></div> <!> <div class="card bg-base-100 shadow-sm"><div class="card-body card-padding svelte-10viwev"><div class="flex justify-between items-center mb-4"><h2 class="card-title">Species List</h2> <div class="btn-group"><button aria-label="Switch to grid view"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM13 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2h-2z"></path></svg></button> <button aria-label="Switch to list view"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button></div></div> <!> <!> <!> <!></div></div></div>');function Bt(L,i){ue(i,!0);let o=ee(!0),m=ee(ce([])),y=ee(ce([])),D=ee("grid"),d=ee(ce({timePeriod:"all",startDate:"",endDate:"",sortOrder:"count_desc",searchTerm:""}));vt(()=>{const e=new Date,t=new Date;t.setDate(e.getDate()-30),a(d).endDate=_(e),a(d).startDate=_(t),M()});function _(e){return e.toISOString().split("T")[0]}function $(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function E(e){return(e*100).toFixed(1)+"%"}function F(e){return e?new Date(e).toLocaleString():""}async function M(){T(o,!0);try{let e,t;const r=new Date;switch(a(d).timePeriod){case"today":e=_(r),t=e;break;case"week":t=_(r),e=_(new Date(r.getTime()-6*24*60*60*1e3));break;case"month":t=_(r),e=_(new Date(r.getTime()-29*24*60*60*1e3));break;case"90days":t=_(r),e=_(new Date(r.getTime()-89*24*60*60*1e3));break;case"year":t=_(r),e=_(new Date(r.getTime()-364*24*60*60*1e3));break;case"custom":e=a(d).startDate,t=a(d).endDate;break;case"all":default:e=null,t=null;break}const p=new URLSearchParams;e&&p.set("start_date",e),t&&p.set("end_date",t);const h=await fetch(`/api/v2/analytics/species/summary?${p.toString()}`);if(!h.ok)throw new Error(`Server responded with ${h.status}`);T(m,await h.json(),!0),z(),W()}catch(e){console.error("Error fetching species data:",e),T(m,[],!0),T(y,[],!0)}finally{T(o,!1)}}function z(){let e=[...a(m)];if(a(d).searchTerm){const t=a(d).searchTerm.toLowerCase();e=e.filter(r=>r.common_name.toLowerCase().includes(t)||r.scientific_name.toLowerCase().includes(t))}switch(a(d).sortOrder){case"count_desc":e.sort((t,r)=>r.count-t.count);break;case"count_asc":e.sort((t,r)=>t.count-r.count);break;case"name_asc":e.sort((t,r)=>t.common_name.localeCompare(r.common_name));break;case"name_desc":e.sort((t,r)=>r.common_name.localeCompare(t.common_name));break;case"first_seen_desc":e.sort((t,r)=>new Date(r.first_heard).getTime()-new Date(t.first_heard).getTime());break;case"first_seen_asc":e.sort((t,r)=>new Date(t.first_heard).getTime()-new Date(r.first_heard).getTime());break;case"last_seen_desc":e.sort((t,r)=>new Date(r.last_heard).getTime()-new Date(t.last_heard).getTime());break;case"confidence_desc":e.sort((t,r)=>r.avg_confidence-t.avg_confidence);break}T(y,e,!0)}function q(){return a(y).length}function H(){return a(m).length}function N(){return a(m).reduce((e,t)=>e+t.count,0)}function Z(){const e=N();return`${$(e)} total detections`}function A(){if(a(m).length===0)return"0%";const e=a(m).reduce((r,p)=>r+p.avg_confidence*p.count,0),t=N();return t===0?"0%":(e/t*100).toFixed(1)+"%"}function R(){a(d).timePeriod="all",a(d).sortOrder="count_desc",a(d).searchTerm="";const e=new Date,t=new Date;t.setDate(e.getDate()-30),a(d).endDate=_(e),a(d).startDate=_(t),M()}async function W(){if(!a(m)||a(m).length===0)return;const e=a(m).filter(t=>!t.thumbnail_url).map(t=>t.scientific_name);if(e.length!==0)try{for(let r=0;r<e.length;r+=20){const p=e.slice(r,r+20),h=new URLSearchParams;p.forEach(u=>h.append("species",u));const f=await fetch(`/api/v2/analytics/species/thumbnails?${h.toString()}`);if(f.ok){const u=await f.json();T(m,a(m).map(C=>u[C.scientific_name]?{...C,thumbnail_url:u[C.scientific_name]}:C),!0),z()}r+20<e.length&&await new Promise(u=>setTimeout(u,100))}}catch(t){console.error("Error loading thumbnails:",t)}}function B(){const e=["Common Name","Scientific Name","Count","Avg Confidence","Max Confidence","First Detected","Last Detected"],t=a(y).map(u=>[u.common_name,u.scientific_name,u.count,(u.avg_confidence*100).toFixed(1)+"%",(u.max_confidence*100).toFixed(1)+"%",u.first_heard?new Date(u.first_heard).toLocaleString():"",u.last_heard?new Date(u.last_heard).toLocaleString():""]),r=[e.join(","),...t.map(u=>u.map(C=>`"${C}"`).join(","))].join(`
`),p=new Blob([r],{type:"text/csv;charset=utf-8;"}),h=document.createElement("a"),f=URL.createObjectURL(p);h.setAttribute("href",f),h.setAttribute("download",`birdnet-species-${new Date().toISOString().split("T")[0]}.csv`),h.style.visibility="hidden",document.body.appendChild(h),h.click(),document.body.removeChild(h)}let I;function G(e){const t=e.target;a(d).searchTerm=t.value,clearTimeout(I),I=setTimeout(()=>{z()},300)}var P=Ht(),j=s(P),l=s(j),v=s(l),J=n(s(v),2),c=s(J);const w=re(H),S=re(Z);je(c,{title:"Total Species",get value(){return a(w)},get subtitle(){return a(S)},iconClassName:"bg-primary/20",icon:t=>{var r=Ct();b(t,r)},$$slots:{icon:!0}});var ne=n(c,2);const K=re(A);je(ne,{title:"Avg Confidence",get value(){return a(K)},subtitle:"Overall average",iconClassName:"bg-secondary/20",icon:t=>{var r=Tt();b(t,r)},$$slots:{icon:!0}});var ae=n(j,2);const Q=re(q);pt(ae,{get isLoading(){return a(o)},get filteredCount(){return a(Q)},onSubmit:M,onReset:R,onExport:B,onSearchInput:G,get filters(){return a(d)},set filters(e){T(d,e,!0)}});var Oe=n(ae,2),Ne=s(Oe),fe=s(Ne),Re=n(s(fe),2),ie=s(Re);let he;ie.__click=[kt,D];var be=n(ie,2);let ge;be.__click=[Lt,D];var pe=n(fe,2);{var Be=e=>{var t=zt();b(e,t)};k(pe,e=>{a(o)&&e(Be)})}var we=n(pe,2);{var Ie=e=>{var t=Ft();Me(t,21,()=>a(y),r=>r.scientific_name,(r,p)=>{St(r,{get species(){return a(p)}})}),b(e,t)};k(we,e=>{!a(o)&&a(D)==="grid"&&e(Ie)})}var xe=n(we,2);{var Ve=e=>{var t=jt(),r=s(t),p=n(s(r));Me(p,23,()=>a(y),h=>h.scientific_name,(h,f,u)=>{var C=Pt(),ye=s(C),qe=s(ye),De=s(qe),Se=s(De);let Ce;var Ze=s(Se);{var We=X=>{var V=Mt();O(()=>{se(V,"src",a(f).thumbnail_url),se(V,"alt",a(f).common_name)}),me("error",V,le=>{const Y=le.target;Y&&(Y.style.display="none",Y.parentElement?.classList.add("bg-base-300"))}),b(X,V)};k(Ze,X=>{a(f).thumbnail_url&&X(We)})}var Ge=n(De,2),Te=s(Ge),Je=s(Te),Ke=n(Te,2),Qe=s(Ke),ke=n(ye),Xe=s(ke),Le=n(ke),Ye=s(Le),oe=s(Ye),et=n(oe,2),tt=s(et),ze=n(Le),at=s(ze),Fe=n(ze),rt=s(Fe),st=n(Fe),nt=s(st);O((X,V,le,Y,it)=>{U(C,1,He(a(u)%2===0?"bg-base-100":"bg-base-200")),Ce=U(Se,1,"mask mask-squircle w-12 h-12",null,Ce,X),x(Je,a(f).common_name),x(Qe,a(f).scientific_name),x(Xe,a(f).count),U(oe,1,`progress w-20 ${a(f).avg_confidence>=.8?"progress-success":a(f).avg_confidence>=.4?"progress-warning":"progress-error"}`),ut(oe,a(f).avg_confidence),x(tt,V),x(at,le),x(rt,Y),x(nt,it)},[()=>({"bg-base-300":!a(f).thumbnail_url}),()=>E(a(f).avg_confidence),()=>E(a(f).max_confidence),()=>F(a(f).first_heard),()=>F(a(f).last_heard)]),b(h,C)}),b(e,t)};k(xe,e=>{!a(o)&&a(D)==="list"&&e(Ve)})}var Ue=n(xe,2);{var $e=e=>{var t=Et();b(e,t)};k(Ue,e=>{!a(o)&&a(y).length===0&&e($e)})}O((e,t)=>{he=U(ie,1,"btn btn-sm",null,he,e),ge=U(be,1,"btn btn-sm",null,ge,t)},[()=>({"btn-active":a(D)==="grid"}),()=>({"btn-active":a(D)==="list"})]),b(L,P),_e()}Ee(["click"]);export{Bt as default};
